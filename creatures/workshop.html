<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Creature Creator - Fun Workshop!</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
/* ============================================
   CREATURE WORKSHOP - Kid-Friendly Edition!
   ============================================ */

* {
    box-sizing: border-box;
}

body {
    background: linear-gradient(135deg, #a855f7 0%, #6366f1 50%, #3b82f6 100%);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: 'Comic Sans MS', 'Chalkboard', system-ui, sans-serif;
    padding: 15px;
    user-select: none;
    overflow-x: hidden;
}

/* Floating background decorations */
body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image:
        radial-gradient(circle at 10% 20%, rgba(255,255,255,0.1) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(255,255,255,0.1) 0%, transparent 20%),
        radial-gradient(circle at 50% 50%, rgba(255,255,255,0.05) 0%, transparent 30%);
    pointer-events: none;
    z-index: 0;
}

.workshop-container {
    background: linear-gradient(180deg, #ffffff 0%, #fef3c7 100%);
    border-radius: 30px;
    padding: 20px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3), inset 0 2px 0 rgba(255,255,255,0.8);
    display: flex;
    flex-direction: column;
    align-items: center;
    max-width: 100%;
    position: relative;
    z-index: 1;
    border: 4px solid #fbbf24;
}

.title {
    font-size: 1.8rem;
    font-weight: 900;
    background: linear-gradient(90deg, #f472b6, #a855f7, #3b82f6, #22c55e);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 10px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
}

/* Fun button bar */
.fun-bar {
    display: flex;
    gap: 8px;
    margin-bottom: 12px;
    flex-wrap: wrap;
    justify-content: center;
}

.fun-btn {
    padding: 10px 16px;
    border-radius: 20px;
    border: 3px solid;
    background: white;
    cursor: pointer;
    font-weight: 800;
    font-size: 14px;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
    box-shadow: 0 4px 0 rgba(0,0,0,0.2);
}

.fun-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 0 rgba(0,0,0,0.2);
}

.fun-btn:active {
    transform: translateY(2px);
    box-shadow: 0 2px 0 rgba(0,0,0,0.2);
}

.fun-btn.pause { border-color: #f97316; color: #f97316; }
.fun-btn.pause.active { background: #f97316; color: white; }
.fun-btn.undo { border-color: #8b5cf6; color: #8b5cf6; }
.fun-btn.reset { border-color: #ef4444; color: #ef4444; }
.fun-btn.random { border-color: #22c55e; color: #22c55e; }
.fun-btn.group { border-color: #8b5cf6; color: #8b5cf6; }
.fun-btn.group.active { background: #8b5cf6; color: white; }
.fun-btn.ungroup { border-color: #6366f1; color: #6366f1; }
.fun-btn.animate { border-color: #f472b6; color: #f472b6; }
.fun-btn.duplicate { border-color: #14b8a6; color: #14b8a6; }
.fun-btn.draw { border-color: #f59e0b; color: #f59e0b; }
.fun-btn.draw.active { background: #f59e0b; color: white; }
.fun-btn.inventor { border-color: #ec4899; color: #ec4899; background: linear-gradient(135deg, #fdf2f8, #fce7f3); }
.fun-btn.inventor:hover { background: linear-gradient(135deg, #ec4899, #db2777); color: white; }

.fun-btn .icon { font-size: 18px; }

/* Shape picker */
.shape-picker {
    display: none;
    gap: 8px;
    margin-bottom: 12px;
    padding: 12px 16px;
    background: linear-gradient(180deg, #fef3c7 0%, #fde68a 100%);
    border-radius: 20px;
    border: 3px solid #f59e0b;
    align-items: center;
    flex-wrap: wrap;
    justify-content: center;
}

.shape-picker.active {
    display: flex;
}

.shape-label {
    font-weight: 700;
    font-size: 13px;
    color: #92400e;
}

.shape-btn {
    width: 40px;
    height: 40px;
    border-radius: 12px;
    border: 3px solid #fbbf24;
    background: white;
    cursor: pointer;
    font-size: 20px;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
}

.shape-btn:hover {
    transform: scale(1.1);
    border-color: #f59e0b;
}

.shape-btn.active {
    background: #fef3c7;
    border-color: #f59e0b;
    box-shadow: 0 0 0 3px rgba(245,158,11,0.3);
}

.shape-picker input[type="color"] {
    width: 40px;
    height: 40px;
    border: 3px solid #fbbf24;
    border-radius: 12px;
    cursor: pointer;
    padding: 2px;
}

.shape-picker input[type="range"] {
    width: 80px;
    height: 10px;
    -webkit-appearance: none;
    background: linear-gradient(90deg, #fde68a, #fbbf24);
    border-radius: 5px;
    cursor: pointer;
}

.shape-picker input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 20px;
    height: 20px;
    background: white;
    border: 3px solid #f59e0b;
    border-radius: 50%;
    cursor: grab;
}

/* Draw mode cursor */
.draw-mode {
    cursor: crosshair !important;
}

.draw-mode [data-part] {
    cursor: crosshair !important;
}

/* Stage wrapper for side-by-side layout */
.stage-wrapper {
    display: flex;
    gap: 12px;
    align-items: stretch;
}

/* Trash bin */
.trash-bin {
    width: 70px;
    background: linear-gradient(180deg, #fecaca 0%, #fca5a5 50%, #f87171 100%);
    border-radius: 20px;
    border: 4px dashed #dc2626;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 15px 10px;
    transition: all 0.3s;
    cursor: default;
}

.trash-bin:hover {
    background: linear-gradient(180deg, #fee2e2 0%, #fecaca 50%, #fca5a5 100%);
}

.trash-bin.drag-over {
    background: linear-gradient(180deg, #fef08a 0%, #fde047 50%, #facc15 100%);
    border-color: #ca8a04;
    transform: scale(1.05);
    box-shadow: 0 0 20px rgba(250,204,21,0.5);
}

.trash-bin.drag-over .trash-icon {
    animation: shake-trash 0.3s ease-in-out infinite;
}

@keyframes shake-trash {
    0%, 100% { transform: rotate(0deg) scale(1.2); }
    25% { transform: rotate(-10deg) scale(1.2); }
    75% { transform: rotate(10deg) scale(1.2); }
}

.trash-icon {
    font-size: 36px;
    margin-bottom: 8px;
    transition: transform 0.2s;
}

.trash-label {
    font-size: 10px;
    font-weight: 700;
    color: #991b1b;
    text-align: center;
    line-height: 1.2;
}

.trash-bin.drag-over .trash-label {
    color: #854d0e;
}

/* Creature stage */
.creature-stage {
    width: 340px;
    height: 480px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: radial-gradient(circle at 50% 30%, #fef9c3 0%, #fde68a 50%, #fcd34d 100%);
    border-radius: 25px;
    position: relative;
    overflow: visible;
    border: 4px solid #f59e0b;
    box-shadow: inset 0 4px 20px rgba(0,0,0,0.1);
}

/* Ground */
.creature-stage::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 60px;
    background: linear-gradient(180deg, #86efac 0%, #22c55e 100%);
    border-radius: 0 0 21px 21px;
}

.creature-name {
    font-size: 1.6rem;
    font-weight: 900;
    color: #db2777;
    margin: 12px 0 8px;
    text-shadow: 2px 2px 0 #fce7f3;
}

/* Selection outline for editable parts */
[data-part] {
    cursor: pointer;
    transition: all 0.15s;
}

[data-part]:hover {
    outline: 3px dashed #a855f7;
    outline-offset: 3px;
    filter: brightness(1.1);
}

[data-part].selected {
    outline: 4px solid #f472b6;
    outline-offset: 4px;
    filter: drop-shadow(0 0 10px rgba(244,114,182,0.5));
}

[data-part].grouped {
    outline: 4px dashed #8b5cf6;
    outline-offset: 4px;
}

[data-part].grouped.selected {
    outline: 4px solid #8b5cf6;
}

[data-part].group-selecting {
    outline: 4px dotted #22c55e;
    outline-offset: 4px;
    animation: group-pulse 0.5s ease-in-out infinite;
}

@keyframes group-pulse {
    0%, 100% { outline-color: #22c55e; }
    50% { outline-color: #86efac; }
}

/* Link indicator */
.link-badge {
    position: absolute;
    top: -8px;
    right: -8px;
    width: 20px;
    height: 20px;
    background: #3b82f6;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    color: white;
    z-index: 100;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

/* Control panel */
.control-panel {
    background: linear-gradient(180deg, #fdf4ff 0%, #f5d0fe 100%);
    border-radius: 20px;
    padding: 15px;
    width: 100%;
    max-width: 340px;
    margin-top: 12px;
    border: 3px solid #d946ef;
}

.control-panel h3 {
    font-weight: 800;
    font-size: 16px;
    color: #a21caf;
    margin-bottom: 10px;
    text-align: center;
}

.slider-row {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
    gap: 8px;
}

.slider-row label {
    width: 50px;
    font-size: 12px;
    font-weight: 700;
    color: #86198f;
}

.slider-row input[type="range"] {
    flex: 1;
    height: 12px;
    -webkit-appearance: none;
    background: linear-gradient(90deg, #f0abfc, #e879f9);
    border-radius: 6px;
    cursor: pointer;
}

.slider-row input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 24px;
    height: 24px;
    background: linear-gradient(135deg, #ffffff, #fdf4ff);
    border: 3px solid #d946ef;
    border-radius: 50%;
    cursor: grab;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

.slider-row .value {
    width: 50px;
    font-size: 11px;
    font-weight: 700;
    color: #a21caf;
    text-align: right;
    background: white;
    padding: 2px 6px;
    border-radius: 8px;
}

/* Layer controls */
.layer-controls {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    margin: 10px 0;
    padding: 10px;
    background: linear-gradient(180deg, #e0f2fe 0%, #bae6fd 100%);
    border-radius: 15px;
    border: 2px solid #0ea5e9;
}

.layer-label {
    font-size: 12px;
    font-weight: 700;
    color: #0369a1;
}

.layer-btn {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    border: 2px solid #0ea5e9;
    background: white;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
}

.layer-btn:hover {
    transform: scale(1.1);
    background: #e0f2fe;
}

.layer-btn:active {
    transform: scale(0.95);
}

.layer-value {
    font-size: 12px;
    font-weight: 700;
    color: #0369a1;
    background: white;
    padding: 4px 10px;
    border-radius: 8px;
    min-width: 50px;
    text-align: center;
}

/* Animation picker */
.animation-section {
    margin: 10px 0;
    padding: 10px;
    background: linear-gradient(180deg, #fef3c7 0%, #fde68a 100%);
    border-radius: 15px;
    border: 2px solid #f59e0b;
}

.animation-section h4 {
    font-size: 13px;
    font-weight: 700;
    color: #92400e;
    margin-bottom: 8px;
    text-align: center;
}

.animation-grid {
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    gap: 4px;
}

.anim-btn {
    width: 100%;
    aspect-ratio: 1;
    border-radius: 8px;
    border: 2px solid #fbbf24;
    background: white;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
}

.anim-btn:hover {
    transform: scale(1.15);
    border-color: #f59e0b;
    background: #fef3c7;
    z-index: 10;
}

.anim-btn:active {
    transform: scale(0.95);
}

/* Color themes */
.theme-section {
    margin-top: 10px;
    padding-top: 10px;
    border-top: 2px dashed #e879f9;
}

.theme-section h4 {
    font-size: 13px;
    font-weight: 700;
    color: #a21caf;
    margin-bottom: 8px;
    text-align: center;
}

.color-themes {
    display: flex;
    gap: 6px;
    justify-content: center;
    flex-wrap: wrap;
}

.theme-btn {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: 3px solid white;
    cursor: pointer;
    box-shadow: 0 3px 6px rgba(0,0,0,0.2);
    transition: all 0.2s;
}

.theme-btn:hover {
    transform: scale(1.15);
}

.theme-btn.rainbow { background: conic-gradient(red, yellow, lime, aqua, blue, magenta, red); }
.theme-btn.ocean { background: linear-gradient(135deg, #0ea5e9, #06b6d4, #22d3ee); }
.theme-btn.forest { background: linear-gradient(135deg, #22c55e, #16a34a, #15803d); }
.theme-btn.sunset { background: linear-gradient(135deg, #f97316, #ef4444, #ec4899); }
.theme-btn.candy { background: linear-gradient(135deg, #f472b6, #a855f7, #6366f1); }
.theme-btn.gold { background: linear-gradient(135deg, #fbbf24, #f59e0b, #d97706); }
.theme-btn.ice { background: linear-gradient(135deg, #e0f2fe, #7dd3fc, #38bdf8); }
.theme-btn.lava { background: linear-gradient(135deg, #dc2626, #f97316, #fbbf24); }

/* Custom color picker */
.color-picker-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 10px;
    justify-content: center;
}

.color-picker-row label {
    font-size: 12px;
    font-weight: 700;
    color: #a21caf;
}

.color-picker-row input[type="color"] {
    width: 50px;
    height: 35px;
    border: 3px solid #d946ef;
    border-radius: 10px;
    cursor: pointer;
    padding: 2px;
}

/* CSS Output */
.css-output {
    background: #1e1b4b;
    color: #c4b5fd;
    padding: 10px;
    border-radius: 12px;
    font-family: 'Monaco', 'Menlo', monospace;
    font-size: 10px;
    line-height: 1.4;
    max-height: 80px;
    overflow-y: auto;
    word-break: break-all;
    margin-top: 10px;
}

.copy-btn {
    width: 100%;
    padding: 12px;
    background: linear-gradient(135deg, #a855f7, #6366f1);
    color: white;
    border: none;
    border-radius: 15px;
    font-weight: 800;
    font-size: 14px;
    cursor: pointer;
    margin-top: 8px;
    transition: all 0.2s;
    box-shadow: 0 4px 0 #4c1d95;
}

.copy-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 0 #4c1d95;
}

.copy-btn:active {
    transform: translateY(2px);
    box-shadow: 0 2px 0 #4c1d95;
}

.copy-btn.copied {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    box-shadow: 0 4px 0 #15803d;
}

/* Save section */
.save-section {
    background: linear-gradient(180deg, #ecfdf5 0%, #d1fae5 100%);
    border-radius: 20px;
    padding: 15px;
    width: 100%;
    max-width: 340px;
    margin-top: 12px;
    border: 3px solid #10b981;
}

.save-section h3 {
    font-weight: 800;
    font-size: 16px;
    color: #065f46;
    margin-bottom: 12px;
    text-align: center;
}

.save-buttons {
    display: flex;
    gap: 8px;
    margin-bottom: 12px;
}

.save-btn {
    flex: 1;
    padding: 12px 8px;
    border-radius: 15px;
    border: 3px solid;
    background: white;
    cursor: pointer;
    font-weight: 700;
    font-size: 12px;
    transition: all 0.2s;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    box-shadow: 0 4px 0 rgba(0,0,0,0.15);
}

.save-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 0 rgba(0,0,0,0.15);
}

.save-btn:active {
    transform: translateY(2px);
    box-shadow: 0 2px 0 rgba(0,0,0,0.15);
}

.save-btn .icon {
    font-size: 24px;
}

.save-btn.download {
    border-color: #10b981;
    color: #065f46;
}

.save-btn.copy-code {
    border-color: #8b5cf6;
    color: #5b21b6;
}

.save-btn.screenshot {
    border-color: #f59e0b;
    color: #92400e;
}

.save-name-row {
    display: flex;
    align-items: center;
    gap: 10px;
}

.save-name-row label {
    font-size: 13px;
    font-weight: 700;
    color: #065f46;
}

.save-name-row input {
    flex: 1;
    padding: 10px 14px;
    border: 3px solid #10b981;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
    font-family: inherit;
    background: white;
}

.save-name-row input:focus {
    outline: none;
    border-color: #059669;
    box-shadow: 0 0 0 3px rgba(16,185,129,0.2);
}

/* No selection message */
.no-selection {
    color: #a21caf;
    font-size: 15px;
    text-align: center;
    padding: 25px;
    font-weight: 600;
}

.no-selection .icon {
    font-size: 40px;
    display: block;
    margin-bottom: 10px;
}

/* Group mode indicator */
.group-mode-indicator {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, #8b5cf6, #6366f1);
    color: white;
    padding: 12px 24px;
    border-radius: 20px;
    font-weight: 700;
    font-size: 14px;
    z-index: 1000;
    box-shadow: 0 4px 15px rgba(139,92,246,0.5);
    display: none;
}

.group-mode-indicator.active {
    display: block;
    animation: pulse 1s infinite;
}

@keyframes pulse {
    0%, 100% { transform: translateX(-50%) scale(1); }
    50% { transform: translateX(-50%) scale(1.05); }
}

/* Animations paused state */
.animations-paused * {
    animation-play-state: paused !important;
}

/* Toast notification */
.toast {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: #1e1b4b;
    color: white;
    padding: 12px 24px;
    border-radius: 20px;
    font-weight: 700;
    font-size: 14px;
    z-index: 1000;
    transition: transform 0.3s;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}

.toast.show {
    transform: translateX(-50%) translateY(0);
}

/* ============================================
   ALL CREATURE ANIMATIONS
   ============================================ */

@keyframes blink{0%,90%,100%{transform:scaleY(1)}93%,97%{transform:scaleY(0.1)}}
@keyframes bounce-slow{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
@keyframes bounce-med{0%,100%{transform:translateY(0)}50%{transform:translateY(-12px)}}
@keyframes hop{0%,100%{transform:translateY(0)}50%{transform:translateY(-15px)}}
@keyframes horse-bounce{0%,100%{transform:translateY(0) rotate(0deg)}50%{transform:translateY(-12px) rotate(1deg)}}
@keyframes horse-blink{0%,90%,100%{transform:scaleY(1)}93%,97%{transform:scaleY(0.1)}}
@keyframes horse-tail-swish{0%,100%{transform:rotate(10deg)}50%{transform:rotate(-25deg)}}
@keyframes horse-leg-kick{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
@keyframes cow-graze{0%,100%{transform:translateY(0) rotate(0deg)}50%{transform:translateY(-8px) rotate(-1deg)}}
@keyframes cow-blink{0%,90%,100%{transform:scaleY(1)}93%,97%{transform:scaleY(0.1)}}
@keyframes cow-tail-swish{0%,100%{transform:rotate(5deg)}50%{transform:rotate(-20deg)}}
@keyframes bunny-hop{0%,100%{transform:translateY(0)}50%{transform:translateY(-15px)}}
@keyframes bunny-blink{0%,90%,100%{transform:scaleY(1)}95%{transform:scaleY(0)}}
@keyframes bunny-ear-wiggle{0%,100%{transform:rotate(-10deg)}50%{transform:rotate(-20deg)}}
@keyframes fox-bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
@keyframes tail-swish{0%,100%{transform:rotate(-15deg)}50%{transform:rotate(0deg)}}
@keyframes ear-wiggle-l{0%,90%,100%{transform:rotate(-25deg)}92%{transform:rotate(-35deg)}94%{transform:rotate(-20deg)}96%{transform:rotate(-30deg)}}
@keyframes ear-wiggle-r{0%,92%,100%{transform:rotate(25deg)}94%{transform:rotate(35deg)}96%{transform:rotate(15deg)}98%{transform:rotate(30deg)}}
@keyframes bear-bounce{0%,100%{transform:translateY(0) rotate(0deg)}50%{transform:translateY(-8px) rotate(1deg)}}
@keyframes bear-blink{0%,90%,100%{transform:scaleY(1)}93%,97%{transform:scaleY(0.1)}}
@keyframes squirrel-bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
@keyframes squirrel-blink{0%,90%,100%{transform:scaleY(1)}93%,97%{transform:scaleY(0.1)}}
@keyframes squirrel-tail-swish{0%,100%{transform:rotate(-5deg)}50%{transform:rotate(5deg)}}
@keyframes trex-stomp{0%,100%{transform:translateY(0)}50%{transform:translateY(-12px)}}
@keyframes trex-blink{0%,90%,100%{transform:scaleY(1)}93%,97%{transform:scaleY(0.1)}}
@keyframes gecko-breathe{0%,100%{transform:scale(1)}50%{transform:scale(1.02)}}
@keyframes gecko-blink{0%,90%,100%{transform:scaleY(1)}93%,97%{transform:scaleY(0.1)}}
@keyframes bird-hop{0%,100%{transform:translateY(0)}50%{transform:translateY(-12px)}}
@keyframes wing-flap-left{0%,100%{transform:translateY(-50%) rotate(-5deg) scaleY(1)}50%{transform:translateY(-50%) rotate(-35deg) scaleY(1.1)}}
@keyframes wing-flap-right{0%,100%{transform:translateY(-50%) rotate(5deg) scaleY(1)}50%{transform:translateY(-50%) rotate(35deg) scaleY(1.1)}}
@keyframes fairy-float{0%,100%{transform:translateY(0)}50%{transform:translateY(-12px)}}
@keyframes jellyfish-float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
@keyframes jellyfish-pulse{0%,100%{transform:scaleY(1) scaleX(1)}50%{transform:scaleY(0.9) scaleX(1.05)}}
@keyframes unicorn-float{0%,100%{transform:translateY(0) rotate(0deg)}50%{transform:translateY(-14px) rotate(0.5deg)}}
@keyframes horn-glow{0%,100%{box-shadow:0 0 15px rgba(255,215,0,0.5),0 0 30px rgba(255,215,0,0.3)}50%{box-shadow:0 0 25px rgba(255,215,0,0.8),0 0 50px rgba(255,215,0,0.5),0 0 70px rgba(255,215,0,0.3)}}
@keyframes flamingo-sway{0%,100%{transform:rotate(-1deg) translateY(0)}50%{transform:rotate(1deg) translateY(-8px)}}
@keyframes flamingo-blink{0%,90%,100%{transform:scaleY(1)}93%,97%{transform:scaleY(0.1)}}
@keyframes neck-bob{0%,100%{transform:rotate(-2deg)}50%{transform:rotate(2deg)}}
@keyframes wing-flutter-l{0%,100%{transform:rotate(20deg)}50%{transform:rotate(30deg)}}
@keyframes wing-flutter-r{0%,100%{transform:rotate(-20deg)}50%{transform:rotate(-30deg)}}
@keyframes tail-wag{0%,100%{transform:rotate(-20deg)}50%{transform:rotate(-10deg)}}
@keyframes penguin-random-waddle{0%,30%{transform:rotate(0deg)}35%{transform:rotate(-2deg)}40%{transform:rotate(2deg)}45%{transform:rotate(-2deg)}50%{transform:rotate(2deg)}55%{transform:rotate(-2deg)}60%{transform:rotate(2deg)}65%{transform:rotate(0deg)}100%{transform:rotate(0deg)}}
@keyframes penguin-blink{0%,90%,100%{transform:scaleY(1)}93%,97%{transform:scaleY(0.1)}}
@keyframes penguin-eye-look{0%,20%{top:3px;left:3px}25%,35%{top:3px;left:8px}40%,50%{top:6px;left:5px}55%,70%{top:3px;left:1px}75%,90%{top:5px;left:6px}95%,100%{top:3px;left:3px}}
@keyframes penguin-foot-l{0%,30%{transform:rotate(0deg) translateY(0)}35%{transform:rotate(8deg) translateY(-6px)}40%{transform:rotate(0deg) translateY(0)}45%{transform:rotate(8deg) translateY(-6px)}50%{transform:rotate(0deg) translateY(0)}55%{transform:rotate(8deg) translateY(-6px)}60%{transform:rotate(0deg) translateY(0)}65%,100%{transform:rotate(0deg) translateY(0)}}
@keyframes penguin-foot-r{0%,32%{transform:rotate(0deg) translateY(0)}37%{transform:rotate(-8deg) translateY(-6px)}42%{transform:rotate(0deg) translateY(0)}47%{transform:rotate(-8deg) translateY(-6px)}52%{transform:rotate(0deg) translateY(0)}57%{transform:rotate(-8deg) translateY(-6px)}62%{transform:rotate(0deg) translateY(0)}67%,100%{transform:rotate(0deg) translateY(0)}}
@keyframes penguin-flipper-l{0%,30%{transform:rotate(15deg)}35%{transform:rotate(45deg)}38%{transform:rotate(15deg)}42%{transform:rotate(45deg)}45%{transform:rotate(15deg)}50%{transform:rotate(45deg)}53%{transform:rotate(15deg)}58%{transform:rotate(45deg)}62%{transform:rotate(15deg)}65%,100%{transform:rotate(15deg)}}
@keyframes penguin-flipper-r{0%,30%{transform:rotate(-15deg)}35%{transform:rotate(-45deg)}38%{transform:rotate(-15deg)}42%{transform:rotate(-45deg)}45%{transform:rotate(-15deg)}50%{transform:rotate(-45deg)}53%{transform:rotate(-15deg)}58%{transform:rotate(-45deg)}62%{transform:rotate(-15deg)}65%,100%{transform:rotate(-15deg)}}
@keyframes penguin-tail-wag{0%,30%{transform:translateX(-50%) rotate(0deg)}35%,40%,45%,50%,55%,60%{transform:translateX(-50%) rotate(5deg)}37%,42%,47%,52%,57%{transform:translateX(-50%) rotate(-5deg)}65%,100%{transform:translateX(-50%) rotate(0deg)}}
/* Pterodactyl Animations */
@keyframes ptero-glide{0%,100%{transform:translateY(0) rotate(0deg)}50%{transform:translateY(-10px) rotate(0deg)}}
@keyframes ptero-wing-l{0%,100%{transform:rotate(10deg)}50%{transform:rotate(-30deg)}}
@keyframes ptero-wing-r{0%,100%{transform:rotate(-10deg)}50%{transform:rotate(30deg)}}
@keyframes ptero-blink{0%,85%,100%{transform:scaleY(1)}88%,92%{transform:scaleY(0.1)}95%{transform:scaleY(1)}97%{transform:scaleY(0.1)}}
/* Pterodactyl Wing Folding - V folds to I shape, wings fold DOWN toward body */
/* Left wing: base -90deg horizontal, folds down. Right wing: base +90deg horizontal, folds down */
@keyframes ptero-upper-arm-l{0%,40%{transform:rotate(-90deg)}45%,95%{transform:rotate(-45deg)}100%{transform:rotate(-90deg)}}
@keyframes ptero-forearm-l{0%,40%{transform:rotate(0deg)}45%,95%{transform:rotate(-90deg)}100%{transform:rotate(0deg)}}
@keyframes ptero-finger-l{0%,40%{transform:rotate(0deg)}45%,95%{transform:rotate(-120deg)}100%{transform:rotate(0deg)}}
@keyframes ptero-upper-arm-r{0%,40%{transform:rotate(90deg)}45%,95%{transform:rotate(45deg)}100%{transform:rotate(90deg)}}
@keyframes ptero-forearm-r{0%,40%{transform:rotate(0deg)}45%,95%{transform:rotate(90deg)}100%{transform:rotate(0deg)}}
@keyframes ptero-finger-r{0%,40%{transform:rotate(0deg)}45%,95%{transform:rotate(120deg)}100%{transform:rotate(0deg)}}
@keyframes tuft-sway{0%,100%{transform:rotate(var(--base-rotate, 0deg))}50%{transform:rotate(calc(var(--base-rotate, 0deg) + 10deg))}}
@keyframes flamingo-upper-leg-tuck{0%,40%{transform:rotate(5deg)}45%,95%{transform:rotate(60deg)}100%{transform:rotate(5deg)}}
@keyframes flamingo-lower-leg-fold{0%,40%{transform:rotate(0deg)}45%,95%{transform:rotate(-140deg)}100%{transform:rotate(0deg)}}
@keyframes flamingo-foot-tuck{0%,40%{transform:rotate(0deg) scale(1)}45%,95%{transform:rotate(50deg) scale(0.7)}100%{transform:rotate(0deg) scale(1)}}
/* Toucan wing - Simple cute flap animation */
@keyframes toucan-wing-flap {
  0%, 100% { transform: rotate(-5deg) scaleY(1); }
  15% { transform: rotate(-45deg) scaleY(0.9); }
  30% { transform: rotate(15deg) scaleY(1.05); }
  45% { transform: rotate(-30deg) scaleY(0.95); }
  60% { transform: rotate(10deg) scaleY(1); }
  75% { transform: rotate(-20deg) scaleY(0.95); }
  90% { transform: rotate(5deg) scaleY(1); }
}
/* Pterodactyl wing animation - Left wing (mirrored) */
@keyframes seg1-anim-l {
  0% { transform: rotate(-82deg); }
  14% { transform: rotate(-16deg); }
  29% { transform: rotate(37deg); }
  43% { transform: rotate(-70deg); }
  57% { transform: rotate(37deg); }
  71% { transform: rotate(-70deg); }
  86% { transform: rotate(37deg); }
  100% { transform: rotate(-82deg); }
}
@keyframes seg2-anim-l {
  0% { transform: rotate(76deg); }
  14% { transform: rotate(16deg); }
  29% { transform: rotate(28deg); }
  43% { transform: rotate(-52deg); }
  57% { transform: rotate(28deg); }
  71% { transform: rotate(-52deg); }
  86% { transform: rotate(28deg); }
  100% { transform: rotate(76deg); }
}
@keyframes seg3-anim-l {
  0% { transform: rotate(-91deg); }
  14% { transform: rotate(-10deg); }
  29% { transform: rotate(13deg); }
  43% { transform: rotate(-94deg); }
  57% { transform: rotate(13deg); }
  71% { transform: rotate(-94deg); }
  86% { transform: rotate(13deg); }
  100% { transform: rotate(-91deg); }
}
@keyframes seg4-anim-l {
  0% { transform: rotate(-100deg); }
  14% { transform: rotate(-19deg); }
  29% { transform: rotate(19deg); }
  43% { transform: rotate(-97deg); }
  57% { transform: rotate(19deg); }
  71% { transform: rotate(-97deg); }
  86% { transform: rotate(19deg); }
  100% { transform: rotate(-100deg); }
}
@keyframes horn-tip-starburst{0%,100%{transform:scale(1) rotate(0deg);opacity:0.9}25%{transform:scale(1.3) rotate(90deg);opacity:1}50%{transform:scale(1) rotate(180deg);opacity:0.9}75%{transform:scale(1.3) rotate(270deg);opacity:1}}
@keyframes horn-tip-pulse{0%,100%{transform:scale(0.8);opacity:0.6}50%{transform:scale(1.2);opacity:1}}
@keyframes horn-tip-rays{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}

/* Wiggle animation for fun feedback */
@keyframes wiggle {
    0%, 100% { transform: rotate(0deg); }
    25% { transform: rotate(-5deg); }
    75% { transform: rotate(5deg); }
}

.wiggle {
    animation: wiggle 0.3s ease-in-out;
}

</style>
</head>
<body>

<!-- Group mode indicator -->
<div class="group-mode-indicator" id="groupModeIndicator">
    Click parts to add to group! Click üì¶ again to finish.
</div>

<!-- Toast notification -->
<div class="toast" id="toast">Copied!</div>

<div class="workshop-container">
    <h1 class="title">Creature Creator!</h1>

    <!-- Fun button bar -->
    <div class="fun-bar">
        <button class="fun-btn pause" id="pauseBtn" onclick="toggleAnimations()">
            <span class="icon">‚è∏Ô∏è</span> Pause
        </button>
        <button class="fun-btn undo" onclick="undo()">
            <span class="icon">‚Ü©Ô∏è</span> Undo
        </button>
        <button class="fun-btn reset" onclick="resetAll()">
            <span class="icon">üîÑ</span> Reset
        </button>
        <button class="fun-btn random" onclick="randomize()">
            <span class="icon">üé≤</span> Mix!
        </button>
        <button class="fun-btn group" id="groupBtn" onclick="toggleGroupMode()">
            <span class="icon">üì¶</span> Group
        </button>
        <button class="fun-btn ungroup" onclick="ungroupSelected()">
            <span class="icon">üì§</span> Ungroup
        </button>
        <button class="fun-btn animate" onclick="generateAnimation()">
            <span class="icon">‚ú®</span> Animate!
        </button>
        <button class="fun-btn duplicate" onclick="duplicatePart()">
            <span class="icon">üìã</span> Copy
        </button>
        <button class="fun-btn draw" id="drawBtn" onclick="toggleDrawMode()">
            <span class="icon">‚úèÔ∏è</span> Draw
        </button>
        <button class="fun-btn inventor" onclick="openInventor()">
            <span class="icon">üí°</span> Inventor
        </button>
    </div>

    <!-- Shape picker for draw mode -->
    <div class="shape-picker" id="shapePicker">
        <span class="shape-label">Pick a shape:</span>
        <button class="shape-btn active" data-shape="circle" onclick="selectShape('circle')">‚≠ï</button>
        <button class="shape-btn" data-shape="square" onclick="selectShape('square')">‚¨ú</button>
        <button class="shape-btn" data-shape="heart" onclick="selectShape('heart')">‚ù§Ô∏è</button>
        <button class="shape-btn" data-shape="star" onclick="selectShape('star')">‚≠ê</button>
        <button class="shape-btn" data-shape="triangle" onclick="selectShape('triangle')">üî∫</button>
        <input type="color" id="drawColor" value="#f472b6" title="Shape color">
        <input type="range" id="drawSize" min="20" max="100" value="40" title="Shape size">
    </div>

    <div class="stage-wrapper">
    <div class="creature-stage" id="stage">

        <!-- ============================================
             CREATURE GOES HERE
             ============================================ -->

        <div id="creature">
            <!-- AXOLOTL BUDDY - Cute Pink Salamander -->
            <style>
            @keyframes axo-float{0%,100%{transform:translateY(0)}50%{transform:translateY(-12px)}}
            @keyframes axo-blink{0%,90%,100%{transform:scaleY(1)}93%,97%{transform:scaleY(0.1)}}
            @keyframes tail-swish{0%,100%{transform:rotate(-5deg)}50%{transform:rotate(8deg)}}
            @keyframes gill-fan-l-1{0%,100%{transform:rotate(35deg)}50%{transform:rotate(45deg)}}
            @keyframes gill-fan-l-2{0%,100%{transform:rotate(0deg)}50%{transform:rotate(5deg)}}
            @keyframes gill-fan-l-3{0%,100%{transform:rotate(-35deg)}50%{transform:rotate(-25deg)}}
            @keyframes gill-fan-r-1{0%,100%{transform:rotate(-35deg)}50%{transform:rotate(-45deg)}}
            @keyframes gill-fan-r-2{0%,100%{transform:rotate(0deg)}50%{transform:rotate(-5deg)}}
            @keyframes gill-fan-r-3{0%,100%{transform:rotate(35deg)}50%{transform:rotate(25deg)}}
            </style>
            <div data-part="container" style="position:relative;width:300px;height:340px;animation:axo-float 4s ease-in-out infinite;z-index:1;">

                <!-- Tail with fin (SVG) -->
                <div data-part="tail" style="position:absolute;width:160px;height:100px;right:-40px;top:170px;z-index:5;transform-origin:left center;animation:tail-swish 3s ease-in-out infinite;">
                    <svg viewBox="0 0 160 100" style="overflow:visible;">
                        <path d="M 0,20 Q 80,0 145,45 Q 155,50 145,55 Q 80,100 0,80 Z" fill="rgba(255,175,204,0.5)" stroke="#fb6f92" stroke-width="1.5"/>
                        <path d="M 0,35 Q 70,30 120,50 Q 70,70 0,65 Z" fill="#ffafcc" stroke="#fb6f92" stroke-width="3"/>
                    </svg>
                </div>

                <!-- Back legs -->
                <div data-part="back-leg-left" style="position:absolute;width:24px;height:32px;background:radial-gradient(ellipse at 40% 30%, #ffc8dd 0%, #ffafcc 50%, #fb6f92 100%);border:3px solid #fb6f92;border-radius:12px;top:245px;left:95px;transform:rotate(10deg);z-index:19;"></div>
                <div data-part="back-leg-right" style="position:absolute;width:24px;height:32px;background:radial-gradient(ellipse at 60% 30%, #ffc8dd 0%, #ffafcc 50%, #fb6f92 100%);border:3px solid #fb6f92;border-radius:12px;top:245px;right:95px;transform:rotate(-10deg);z-index:19;"></div>

                <!-- Front legs -->
                <div data-part="front-leg-left" style="position:absolute;width:24px;height:32px;background:radial-gradient(ellipse at 40% 30%, #ffc8dd 0%, #ffafcc 50%, #fb6f92 100%);border:3px solid #fb6f92;border-radius:12px;top:220px;left:65px;transform:rotate(25deg);z-index:19;"></div>
                <div data-part="front-leg-right" style="position:absolute;width:24px;height:32px;background:radial-gradient(ellipse at 60% 30%, #ffc8dd 0%, #ffafcc 50%, #fb6f92 100%);border:3px solid #fb6f92;border-radius:12px;top:220px;right:65px;transform:rotate(-25deg);z-index:19;"></div>

                <!-- Body -->
                <div data-part="body" style="position:absolute;width:150px;height:100px;background:radial-gradient(ellipse at 50% 40%, #ffc8dd 0%, #ffafcc 60%, #fb6f92 100%);border:4px solid #fb6f92;border-radius:50% 50% 42% 42% / 65% 65% 38% 38%;top:170px;left:75px;z-index:20;overflow:hidden;box-shadow:inset 5px 5px 15px rgba(255,255,255,0.4),inset -3px -3px 10px rgba(251,111,146,0.3);">
                    <!-- Tummy -->
                    <div style="position:absolute;width:90px;height:60px;background:radial-gradient(ellipse at 50% 50%, #ffe5ec 0%, #ffc8dd 100%);border-radius:50%;bottom:-15px;left:50%;transform:translateX(-50%);"></div>
                </div>

                <!-- Head wrapper (contains gills and head) -->
                <div data-part="head" style="position:absolute;width:160px;height:115px;top:90px;left:70px;z-index:40;">

                    <!-- Left gills (fanned) -->
                    <div style="position:absolute;width:65px;height:16px;background:radial-gradient(ellipse at 80% 50%, #ff8fab 0%, #ff5d8f 50%, #fb6f92 100%);border:3px solid #fb6f92;border-radius:20px;top:45px;left:-35px;transform-origin:right center;transform:rotate(35deg);z-index:-1;animation:gill-fan-l-1 3s ease-in-out infinite;box-shadow:inset 2px 2px 5px rgba(255,255,255,0.3);"></div>
                    <div style="position:absolute;width:65px;height:16px;background:radial-gradient(ellipse at 80% 50%, #ff8fab 0%, #ff5d8f 50%, #fb6f92 100%);border:3px solid #fb6f92;border-radius:20px;top:45px;left:-35px;transform-origin:right center;transform:rotate(0deg);z-index:-1;animation:gill-fan-l-2 3s ease-in-out infinite;box-shadow:inset 2px 2px 5px rgba(255,255,255,0.3);"></div>
                    <div style="position:absolute;width:65px;height:16px;background:radial-gradient(ellipse at 80% 50%, #ff8fab 0%, #ff5d8f 50%, #fb6f92 100%);border:3px solid #fb6f92;border-radius:20px;top:45px;left:-35px;transform-origin:right center;transform:rotate(-35deg);z-index:-1;animation:gill-fan-l-3 3s ease-in-out infinite;box-shadow:inset 2px 2px 5px rgba(255,255,255,0.3);"></div>

                    <!-- Right gills (fanned) -->
                    <div style="position:absolute;width:65px;height:16px;background:radial-gradient(ellipse at 20% 50%, #ff8fab 0%, #ff5d8f 50%, #fb6f92 100%);border:3px solid #fb6f92;border-radius:20px;top:45px;right:-35px;transform-origin:left center;transform:rotate(-35deg);z-index:-1;animation:gill-fan-r-1 3s ease-in-out infinite;box-shadow:inset -2px 2px 5px rgba(255,255,255,0.3);"></div>
                    <div style="position:absolute;width:65px;height:16px;background:radial-gradient(ellipse at 20% 50%, #ff8fab 0%, #ff5d8f 50%, #fb6f92 100%);border:3px solid #fb6f92;border-radius:20px;top:45px;right:-35px;transform-origin:left center;transform:rotate(0deg);z-index:-1;animation:gill-fan-r-2 3s ease-in-out infinite;box-shadow:inset -2px 2px 5px rgba(255,255,255,0.3);"></div>
                    <div style="position:absolute;width:65px;height:16px;background:radial-gradient(ellipse at 20% 50%, #ff8fab 0%, #ff5d8f 50%, #fb6f92 100%);border:3px solid #fb6f92;border-radius:20px;top:45px;right:-35px;transform-origin:left center;transform:rotate(35deg);z-index:-1;animation:gill-fan-r-3 3s ease-in-out infinite;box-shadow:inset -2px 2px 5px rgba(255,255,255,0.3);"></div>

                    <!-- Head shape -->
                    <div style="width:100%;height:100%;background:radial-gradient(ellipse at 50% 40%, #ffc8dd 0%, #ffafcc 60%, #fb6f92 100%);border:4px solid #fb6f92;border-radius:55% 55% 45% 45% / 65% 65% 35% 35%;position:relative;z-index:41;box-shadow:inset 5px 5px 15px rgba(255,255,255,0.4),inset -3px -3px 10px rgba(251,111,146,0.3);">

                        <!-- Eyes -->
                        <div style="position:absolute;top:48px;left:50%;transform:translateX(-50%);display:flex;gap:56px;">
                            <div style="width:18px;height:18px;background:radial-gradient(circle at 35% 35%, #4a3f3f 0%, #2d2323 100%);border-radius:50%;position:relative;animation:axo-blink 5s infinite;box-shadow:0 0 5px rgba(0,0,0,0.2);">
                                <div style="position:absolute;width:6px;height:6px;background:white;border-radius:50%;top:3px;left:3px;"></div>
                            </div>
                            <div style="width:18px;height:18px;background:radial-gradient(circle at 35% 35%, #4a3f3f 0%, #2d2323 100%);border-radius:50%;position:relative;animation:axo-blink 5s infinite;box-shadow:0 0 5px rgba(0,0,0,0.2);">
                                <div style="position:absolute;width:6px;height:6px;background:white;border-radius:50%;top:3px;left:3px;"></div>
                            </div>
                        </div>

                        <!-- Blush marks -->
                        <div style="position:absolute;width:22px;height:11px;background:radial-gradient(ellipse, #ff5d8f, transparent);border-radius:50%;top:65px;left:20px;opacity:0.3;filter:blur(2px);"></div>
                        <div style="position:absolute;width:22px;height:11px;background:radial-gradient(ellipse, #ff5d8f, transparent);border-radius:50%;top:65px;right:20px;opacity:0.3;filter:blur(2px);"></div>

                        <!-- Cute smile -->
                        <div style="position:absolute;width:55px;height:15px;border-bottom:3.5px solid #fb6f92;border-radius:0 0 25px 25px;top:70px;left:50%;transform:translateX(-50%);"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================ -->

    </div>

    <!-- Trash bin -->
    <div class="trash-bin" id="trashBin">
        <div class="trash-icon">üóëÔ∏è</div>
        <div class="trash-label">Drop here to delete!</div>
    </div>
    </div>

    <h2 class="creature-name">Axolotl Buddy!</h2>

    <!-- Control Panel -->
    <div class="control-panel">
        <div id="noSelection" class="no-selection">
            <span class="icon">üëÜ</span>
            Tap a body part to edit it!
        </div>
        <div id="controlsActive" style="display:none;">
            <h3>Editing: <span id="partName">-</span></h3>

            <div class="slider-row">
                <label>‚ÜïÔ∏è Up</label>
                <input type="range" id="topSlider" min="-50" max="400" value="0" oninput="updatePosition('top', this.value)">
                <span class="value" id="topValue">0px</span>
            </div>

            <div class="slider-row">
                <label>‚ÜîÔ∏è Side</label>
                <input type="range" id="leftSlider" min="-50" max="350" value="0" oninput="updatePosition('left', this.value)">
                <span class="value" id="leftValue">0px</span>
            </div>

            <div class="slider-row">
                <label>üîÑ Spin</label>
                <input type="range" id="rotationSlider" min="-180" max="180" value="0" oninput="updateRotation(this.value)">
                <span class="value" id="rotationValue">0¬∞</span>
            </div>

            <div class="slider-row">
                <label>üìè Size</label>
                <input type="range" id="scaleSlider" min="50" max="200" value="100" oninput="updateScale(this.value)">
                <span class="value" id="scaleValue">100%</span>
            </div>

            <div class="slider-row">
                <label>‚ÜîÔ∏è Width</label>
                <input type="range" id="widthSlider" min="10" max="300" value="100" oninput="updateWidth(this.value)">
                <span class="value" id="widthValue">100px</span>
            </div>

            <div class="slider-row">
                <label>‚ÜïÔ∏è Height</label>
                <input type="range" id="heightSlider" min="10" max="300" value="100" oninput="updateHeight(this.value)">
                <span class="value" id="heightValue">100px</span>
            </div>

            <!-- Animation picker -->
            <div class="animation-section">
                <h4>‚ú® Animation</h4>
                <div class="animation-grid">
                    <button class="anim-btn" onclick="applyAnimation('none')" title="No animation">‚èπÔ∏è</button>
                    <button class="anim-btn" onclick="applyAnimation('bounce-custom 0.5s ease-in-out infinite')" title="Bouncy">üèÄ</button>
                    <button class="anim-btn" onclick="applyAnimation('wiggle-custom 0.3s ease-in-out infinite')" title="Wiggle">üêõ</button>
                    <button class="anim-btn" onclick="applyAnimation('spin-custom 2s linear infinite')" title="Spin">üåÄ</button>
                    <button class="anim-btn" onclick="applyAnimation('pulse-custom 1s ease-in-out infinite')" title="Pulse">üíì</button>
                    <button class="anim-btn" onclick="applyAnimation('shake-custom 0.5s ease-in-out infinite')" title="Shake">ü´®</button>
                    <button class="anim-btn" onclick="applyAnimation('float-custom 2s ease-in-out infinite')" title="Float">‚òÅÔ∏è</button>
                    <button class="anim-btn" onclick="applyAnimation('jelly-custom 0.8s ease-in-out infinite')" title="Jelly">üçÆ</button>
                    <button class="anim-btn" onclick="applyAnimation('swing-custom 1s ease-in-out infinite')" title="Swing">üéã</button>
                    <button class="anim-btn" onclick="applyAnimation('zoom-custom 0.6s ease-in-out infinite')" title="Zoom">üîç</button>
                    <button class="anim-btn" onclick="applyAnimation('wobble-custom 1s ease-in-out infinite')" title="Wobble">ü•¥</button>
                    <button class="anim-btn" onclick="applyAnimation('flicker-custom 0.2s steps(2) infinite')" title="Flicker">üí°</button>
                    <button class="anim-btn" onclick="applyAnimation('tilt-custom 0.5s ease-in-out infinite alternate')" title="Tilt">‚ÜóÔ∏è</button>
                    <button class="anim-btn" onclick="applyAnimation('pop-custom 0.4s ease-in-out infinite')" title="Pop">üéà</button>
                    <button class="anim-btn" onclick="applyAnimation('breathe-custom 3s ease-in-out infinite')" title="Breathe">üå¨Ô∏è</button>
                    <button class="anim-btn" onclick="applyAnimation('dance-custom 0.6s ease-in-out infinite')" title="Dance">üíÉ</button>
                </div>
            </div>

            <!-- Layer controls -->
            <div class="layer-controls">
                <span class="layer-label">üìö Layer:</span>
                <button class="layer-btn" onclick="changeLayer(-10)" title="Send way back">‚è¨</button>
                <button class="layer-btn" onclick="changeLayer(-1)" title="Send back">üîΩ</button>
                <span class="layer-value" id="layerValue">z: 50</span>
                <button class="layer-btn" onclick="changeLayer(1)" title="Bring forward">üîº</button>
                <button class="layer-btn" onclick="changeLayer(10)" title="Bring way forward">‚è´</button>
            </div>

            <!-- Color themes -->
            <div class="theme-section">
                <h4>üé® Color Themes</h4>
                <div class="color-themes">
                    <button class="theme-btn rainbow" onclick="applyTheme('rainbow')" title="Rainbow"></button>
                    <button class="theme-btn ocean" onclick="applyTheme('ocean')" title="Ocean"></button>
                    <button class="theme-btn forest" onclick="applyTheme('forest')" title="Forest"></button>
                    <button class="theme-btn sunset" onclick="applyTheme('sunset')" title="Sunset"></button>
                    <button class="theme-btn candy" onclick="applyTheme('candy')" title="Candy"></button>
                    <button class="theme-btn gold" onclick="applyTheme('gold')" title="Gold"></button>
                    <button class="theme-btn ice" onclick="applyTheme('ice')" title="Ice"></button>
                    <button class="theme-btn lava" onclick="applyTheme('lava')" title="Lava"></button>
                </div>

                <div class="color-picker-row">
                    <label>Custom:</label>
                    <input type="color" id="customColor" value="#f472b6" onchange="applyCustomColor(this.value)">
                </div>
            </div>

            <div class="css-output" id="cssOutput">
                /* Select a part to see CSS */
            </div>

            <button class="copy-btn" id="copyBtn" onclick="copyCSS()">üìã Copy CSS</button>
        </div>
    </div>

    <!-- Save & Share Section -->
    <div class="save-section">
        <h3>üíæ Save Your Creation!</h3>
        <div class="save-buttons">
            <button class="save-btn download" onclick="downloadCreature()">
                <span class="icon">üì•</span> Download
            </button>
            <button class="save-btn copy-code" onclick="copyCreatureCode()">
                <span class="icon">üìã</span> Copy Code
            </button>
            <button class="save-btn screenshot" onclick="takeScreenshot()">
                <span class="icon">üì∏</span> Screenshot
            </button>
        </div>
        <div class="save-name-row">
            <label>Name:</label>
            <input type="text" id="creatureName" value="My Creature" placeholder="Name your creature!">
        </div>
    </div>
</div>

<div style="margin-top:15px;color:white;opacity:0.8;font-size:12px;text-align:center;">
    Creature Creator v4.0 | Made for Kids!
</div>

<!-- Scribby Inventor Modal -->
<div id="inventorModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:9999;justify-content:center;align-items:center;padding:20px;">
    <div style="background:linear-gradient(135deg,#fdf2f8,#fce7f3);border-radius:24px;max-width:600px;width:100%;max-height:85vh;overflow-y:auto;padding:24px;box-shadow:0 20px 60px rgba(0,0,0,0.4);border:4px solid #ec4899;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
            <h2 style="font-size:1.5rem;font-weight:900;color:#be185d;margin:0;">üí° Scribby Inventor</h2>
            <button onclick="closeInventor()" style="background:#ec4899;color:white;border:none;border-radius:50%;width:36px;height:36px;font-size:20px;cursor:pointer;font-weight:bold;">√ó</button>
        </div>

        <div style="background:white;border-radius:16px;padding:16px;margin-bottom:16px;border:2px solid #f9a8d4;">
            <h3 style="color:#be185d;margin:0 0 8px 0;font-size:1rem;">üìã How It Works:</h3>
            <ol style="margin:0;padding-left:20px;color:#831843;font-size:14px;line-height:1.6;">
                <li>Copy the <strong>variant ideas</strong> below and share with Claude</li>
                <li>Tell Claude which variants you want to create</li>
                <li>Claude will generate the CSS code for each new Scribby</li>
                <li>Use this workshop to preview and tweak the designs!</li>
            </ol>
        </div>

        <div style="background:white;border-radius:16px;padding:16px;margin-bottom:16px;border:2px solid #f9a8d4;">
            <h3 style="color:#be185d;margin:0 0 12px 0;font-size:1rem;">‚ú® New Variant Ideas by Category:</h3>
            <div id="inventorIdeas" style="font-size:13px;color:#1f2937;line-height:1.7;">
                <p style="margin:0 0 12px 0;"><strong style="color:#0ea5e9;">üê¶ Birds:</strong> Phoenix, Peacock, Hummingbird, Snowy Owl, Blue Jay, Cardinal, Kingfisher, Kiwi, Puffin</p>
                <p style="margin:0 0 12px 0;"><strong style="color:#22c55e;">ü¶é Reptiles:</strong> Chameleon, Bearded Dragon, Sea Turtle, Komodo Dragon, Iguana, Salamander, Newt</p>
                <p style="margin:0 0 12px 0;"><strong style="color:#f59e0b;">üêª Mammals:</strong> Hedgehog, Otter, Deer, Wolf, Hamster, Chinchilla, Ferret, Polar Bear, Snow Leopard</p>
                <p style="margin:0 0 12px 0;"><strong style="color:#a855f7;">ü¶Ñ Mystical:</strong> Griffin, Kitsune (9-tailed fox), Cerberus, Hippogriff, Chimera, Thunderbird, Moon Rabbit</p>
                <p style="margin:0 0 12px 0;"><strong style="color:#78716c;">ü¶ï Prehistoric:</strong> Pterodactyl, Triceratops, Velociraptor, Woolly Mammoth, Sabertooth, Ankylosaurus</p>
                <p style="margin:0 0 12px 0;"><strong style="color:#0891b2;">üêô Aquatic:</strong> Seahorse, Clownfish, Manta Ray, Orca, Dolphin, Starfish, Lobster, Crab, Pufferfish</p>
                <p style="margin:0 0 12px 0;"><strong style="color:#7c3aed;">üëΩ Alien:</strong> Crystal Being, Nebula Creature, Void Walker, Star Sprite, Cosmic Jellyfish, Galaxy Fox</p>
                <p style="margin:0;"><strong style="color:#dc2626;">üêõ Insects:</strong> Firefly, Dragonfly, Praying Mantis, Atlas Moth, Stag Beetle, Cicada, Luna Moth</p>
            </div>
        </div>

        <div style="background:linear-gradient(135deg,#fef3c7,#fde68a);border-radius:16px;padding:16px;margin-bottom:16px;border:2px solid #f59e0b;">
            <h3 style="color:#92400e;margin:0 0 8px 0;font-size:1rem;">üé® Color Variant Ideas:</h3>
            <p style="margin:0;color:#78350f;font-size:13px;line-height:1.6;">
                <strong>Golden</strong> (any creature), <strong>Crystal/Ice</strong>, <strong>Shadow/Dark</strong>, <strong>Rainbow/Prismatic</strong>, <strong>Sakura/Cherry Blossom</strong>, <strong>Neon/Cyber</strong>, <strong>Autumn/Fall Colors</strong>, <strong>Galaxy/Cosmic</strong>, <strong>Albino/White</strong>, <strong>Ember/Lava</strong>
            </p>
        </div>

        <div style="background:#f3e8ff;border-radius:16px;padding:16px;border:2px solid #c084fc;">
            <h3 style="color:#7c3aed;margin:0 0 8px 0;font-size:1rem;">üí¨ Prompt for Claude:</h3>
            <div style="background:white;border-radius:8px;padding:12px;font-family:monospace;font-size:12px;color:#374151;border:1px solid #e9d5ff;">
                "Create a new [CATEGORY] adult variant called [NAME]. Base it on the existing [SIMILAR_CREATURE] design but with [COLOR_SCHEME] colors. Add [SPECIAL_FEATURE] for extra flair."
            </div>
        </div>

        <button onclick="closeInventor()" style="width:100%;margin-top:16px;padding:14px;background:linear-gradient(135deg,#ec4899,#db2777);color:white;border:none;border-radius:16px;font-size:16px;font-weight:800;cursor:pointer;box-shadow:0 4px 12px rgba(236,72,153,0.4);">
            Got it! Let's Create! üöÄ
        </button>
    </div>
</div>

<script>
// Scribby Inventor Modal Functions
function openInventor() {
    document.getElementById('inventorModal').style.display = 'flex';
}
function closeInventor() {
    document.getElementById('inventorModal').style.display = 'none';
}

// State
let selectedPart = null;
let isDragging = false;
let dragStartX = 0;
let dragStartY = 0;
let partStartTop = 0;
let partStartLeft = 0;
let animationsPaused = false;
let groupMode = false;
let drawMode = false;
let currentShape = 'circle';
let shapeCounter = 0;
let groupCounter = 0;
let groups = new Map(); // Maps group ID to Set of part names
let partToGroup = new Map(); // Maps part name to group ID
let currentGroupSelection = new Set(); // Parts being selected for new group
let originalStyles = new Map();
let undoStack = [];
const MAX_UNDO = 20;

// Color themes
const themes = {
    rainbow: ['#ef4444', '#f97316', '#eab308', '#22c55e', '#3b82f6', '#8b5cf6'],
    ocean: ['#0ea5e9', '#06b6d4', '#22d3ee', '#67e8f9', '#a5f3fc', '#cffafe'],
    forest: ['#22c55e', '#16a34a', '#15803d', '#166534', '#14532d', '#86efac'],
    sunset: ['#f97316', '#ef4444', '#ec4899', '#f472b6', '#fb923c', '#fbbf24'],
    candy: ['#f472b6', '#a855f7', '#6366f1', '#ec4899', '#d946ef', '#8b5cf6'],
    gold: ['#fbbf24', '#f59e0b', '#d97706', '#fcd34d', '#fde68a', '#b45309'],
    ice: ['#e0f2fe', '#7dd3fc', '#38bdf8', '#0ea5e9', '#bae6fd', '#f0f9ff'],
    lava: ['#dc2626', '#f97316', '#fbbf24', '#ef4444', '#b91c1c', '#ea580c']
};

// Store original styles
document.querySelectorAll('[data-part]').forEach(part => {
    originalStyles.set(part.dataset.part, part.getAttribute('style'));
});

// Click to select
document.querySelectorAll('[data-part]').forEach(part => {
    part.addEventListener('click', (e) => {
        e.stopPropagation();

        if (groupMode) {
            // Group mode: add/remove part from selection
            togglePartInGroupSelection(part);
            return;
        }

        selectPart(part);
    });

    // Drag handlers
    part.addEventListener('mousedown', startDrag);
    part.addEventListener('touchstart', startDrag, {passive: false});
});

// Deselect when clicking stage
document.getElementById('stage').addEventListener('click', (e) => {
    if (e.target.id === 'stage' || e.target.classList.contains('creature-stage')) {
        deselectAll();
    }
});

// Global drag handlers
document.addEventListener('mousemove', onDrag);
document.addEventListener('touchmove', onDrag, {passive: false});
document.addEventListener('mouseup', endDrag);
document.addEventListener('touchend', endDrag);

function saveState() {
    const state = {};
    document.querySelectorAll('[data-part]').forEach(part => {
        state[part.dataset.part] = part.getAttribute('style');
    });
    undoStack.push(state);
    if (undoStack.length > MAX_UNDO) {
        undoStack.shift();
    }
}

function undo() {
    if (undoStack.length === 0) {
        showToast('Nothing to undo!');
        return;
    }

    const state = undoStack.pop();
    Object.entries(state).forEach(([partName, style]) => {
        const part = document.querySelector(`[data-part="${partName}"]`);
        if (part) {
            part.setAttribute('style', style);
        }
    });

    if (selectedPart) {
        updateSliders();
        updateCSSOutput();
    }

    showToast('Undone! ‚Ü©Ô∏è');
}

function selectPart(part) {
    if (selectedPart) {
        selectedPart.classList.remove('selected');
    }

    selectedPart = part;
    part.classList.add('selected');
    part.classList.add('wiggle');
    setTimeout(() => part.classList.remove('wiggle'), 300);

    document.getElementById('noSelection').style.display = 'none';
    document.getElementById('controlsActive').style.display = 'block';
    document.getElementById('partName').textContent = part.dataset.part.replace('-', ' ');

    updateSliders();
    updateCSSOutput();
}

function deselectAll() {
    if (selectedPart) {
        selectedPart.classList.remove('selected');
        selectedPart = null;
    }
    document.getElementById('noSelection').style.display = 'block';
    document.getElementById('controlsActive').style.display = 'none';

    if (linkMode) {
        toggleLinkMode();
    }
}

function startDrag(e) {
    if (!selectedPart) return;
    const target = e.target.closest('[data-part]');
    if (target !== selectedPart) return;

    saveState();
    e.preventDefault();
    isDragging = true;

    const touch = e.touches ? e.touches[0] : e;
    dragStartX = touch.clientX;
    dragStartY = touch.clientY;

    const style = selectedPart.style;
    partStartTop = parseInt(style.top) || 0;
    partStartLeft = parseInt(style.left) || 0;
}

function onDrag(e) {
    if (!isDragging || !selectedPart) return;
    e.preventDefault();

    const touch = e.touches ? e.touches[0] : e;
    const deltaX = touch.clientX - dragStartX;
    const deltaY = touch.clientY - dragStartY;

    const style = selectedPart.style;
    const usesBottom = style.bottom && style.bottom !== 'auto' && !style.top;

    if (usesBottom) {
        const currentBottom = parseInt(style.bottom) || 0;
        selectedPart.style.bottom = (currentBottom - (touch.clientY - dragStartY)) + 'px';
        dragStartY = touch.clientY;
    } else {
        selectedPart.style.top = (partStartTop + deltaY) + 'px';
    }

    selectedPart.style.left = (partStartLeft + deltaX) + 'px';

    // Move grouped parts
    moveGroupedParts(selectedPart.dataset.part, deltaX, deltaY);

    // Check if hovering over trash bin
    const trashBin = document.getElementById('trashBin');
    const trashRect = trashBin.getBoundingClientRect();
    const isOverTrash = touch.clientX >= trashRect.left && touch.clientX <= trashRect.right &&
                        touch.clientY >= trashRect.top && touch.clientY <= trashRect.bottom;

    if (isOverTrash && canDeletePart(selectedPart.dataset.part)) {
        trashBin.classList.add('drag-over');
    } else {
        trashBin.classList.remove('drag-over');
    }

    updateSliders();
    updateCSSOutput();
}

function moveGroupedParts(partName, deltaX, deltaY) {
    const groupId = partToGroup.get(partName);
    if (!groupId) return;

    const group = groups.get(groupId);
    if (!group) return;

    group.forEach(groupedName => {
        if (groupedName === partName) return; // Skip the part being dragged
        const groupedPart = document.querySelector(`[data-part="${groupedName}"]`);
        if (groupedPart) {
            const style = groupedPart.style;
            const currentTop = parseInt(style.top) || 0;
            const currentLeft = parseInt(style.left) || 0;
            groupedPart.style.top = (currentTop + deltaY) + 'px';
            groupedPart.style.left = (currentLeft + deltaX) + 'px';
        }
    });
}

function endDrag(e) {
    if (isDragging && selectedPart) {
        // Check if dropped on trash bin
        const trashBin = document.getElementById('trashBin');
        const trashRect = trashBin.getBoundingClientRect();

        const touch = e.changedTouches ? e.changedTouches[0] : e;
        const dropX = touch.clientX;
        const dropY = touch.clientY;

        if (dropX >= trashRect.left && dropX <= trashRect.right &&
            dropY >= trashRect.top && dropY <= trashRect.bottom) {
            // Dropped on trash - check if deletable
            const partName = selectedPart.dataset.part;
            if (canDeletePart(partName)) {
                saveState();
                selectedPart.remove();
                deselectAll();
                showToast('Deleted! üóëÔ∏è');
                trashBin.classList.remove('drag-over');
                isDragging = false;
                return;
            } else {
                showToast("Can't delete original parts! ‚ùå");
            }
        }

        // Reset start positions for next drag
        partStartTop = parseInt(selectedPart.style.top) || 0;
        partStartLeft = parseInt(selectedPart.style.left) || 0;
    }

    // Remove drag-over state from trash
    document.getElementById('trashBin').classList.remove('drag-over');
    isDragging = false;
}

// Original flamingo parts that cannot be deleted
const originalParts = new Set([
    'left-foot', 'left-ankle', 'left-webbing', 'left-toe-left', 'left-toe-center', 'left-toe-right',
    'right-leg', 'right-upper-leg', 'right-knee', 'right-lower-leg', 'right-foot',
    'right-ankle', 'right-webbing', 'right-toe-left', 'right-toe-center', 'right-toe-right',
    'left-leg', 'left-lower-leg', 'left-knee', 'left-upper-leg',
    'tail', 'tail-feather-1', 'tail-feather-2', 'tail-feather-3',
    'left-wing', 'right-wing', 'body', 'neck', 'head',
    'tuft', 'tuft-left', 'tuft-center', 'tuft-right',
    'left-eye', 'right-eye', 'beak-upper', 'beak-tip', 'blush'
]);

// Check if a part can be deleted
function canDeletePart(partName) {
    // Can delete anything that's not an original part
    return !originalParts.has(partName);
}

function updateSliders() {
    if (!selectedPart) return;

    const style = selectedPart.style;
    const computed = window.getComputedStyle(selectedPart);

    // Get position from inline style or computed
    const top = parseInt(style.top) || parseInt(computed.top) || 0;
    const left = parseInt(style.left) || parseInt(computed.left) || 0;

    document.getElementById('topSlider').value = Math.max(0, Math.min(500, top));
    document.getElementById('topValue').textContent = top + 'px';

    document.getElementById('leftSlider').value = Math.max(0, Math.min(500, left));
    document.getElementById('leftValue').textContent = left + 'px';

    // Get transform - check both inline and attribute
    const inlineTransform = style.transform || '';
    const attrStyle = selectedPart.getAttribute('style') || '';
    const attrTransformMatch = attrStyle.match(/transform\s*:\s*([^;]+)/);
    const transform = inlineTransform || (attrTransformMatch ? attrTransformMatch[1] : '');

    // Get rotation from transform
    const rotateMatch = transform.match(/rotate\((-?[\d.]+)deg\)/);
    const rotation = rotateMatch ? Math.round(parseFloat(rotateMatch[1])) : 0;
    document.getElementById('rotationSlider').value = Math.max(-180, Math.min(180, rotation));
    document.getElementById('rotationValue').textContent = rotation + '¬∞';

    // Get scale
    const scaleMatch = transform.match(/scale\(([\d.]+)\)/);
    const scale = scaleMatch ? Math.round(parseFloat(scaleMatch[1]) * 100) : 100;
    document.getElementById('scaleSlider').value = scale;
    document.getElementById('scaleValue').textContent = scale + '%';

    // Get width from computed style (more reliable)
    const width = parseInt(computed.width) || parseInt(style.width) || 100;
    document.getElementById('widthSlider').value = Math.max(10, Math.min(300, width));
    document.getElementById('widthValue').textContent = width + 'px';

    // Get height from computed style (more reliable)
    const height = parseInt(computed.height) || parseInt(style.height) || 100;
    document.getElementById('heightSlider').value = Math.max(10, Math.min(300, height));
    document.getElementById('heightValue').textContent = height + 'px';

    // Get z-index
    const zIndex = parseInt(style.zIndex) || parseInt(computed.zIndex) || 0;
    document.getElementById('layerValue').textContent = 'z: ' + zIndex;
}

function changeLayer(delta) {
    if (!selectedPart) return;
    saveState();

    const currentZ = parseInt(selectedPart.style.zIndex) || 0;
    const newZ = Math.max(0, Math.min(100, currentZ + delta));
    selectedPart.style.zIndex = newZ;

    document.getElementById('layerValue').textContent = 'z: ' + newZ;

    // Show feedback
    if (delta > 0) {
        showToast(delta > 1 ? '‚è´ Way forward!' : 'üîº Forward!');
    } else {
        showToast(delta < -1 ? '‚è¨ Way back!' : 'üîΩ Back!');
    }

    updateCSSOutput();
}

function updatePosition(prop, value) {
    if (!selectedPart) return;
    saveState();
    selectedPart.style[prop] = value + 'px';
    document.getElementById(prop + 'Value').textContent = value + 'px';
    updateCSSOutput();
}

function updateRotation(value) {
    if (!selectedPart) return;
    saveState();

    // Check if element has an animation that controls transform
    const computed = window.getComputedStyle(selectedPart);
    const animation = computed.animation || selectedPart.style.animation;

    if (animation && animation !== 'none' && animation !== '') {
        // Pause the animation so our rotation takes effect
        selectedPart.style.animationPlayState = 'paused';
        showToast('Animation paused for rotation');
    }

    // Get existing transform from attribute or style
    const attrStyle = selectedPart.getAttribute('style') || '';
    const attrTransformMatch = attrStyle.match(/transform\s*:\s*([^;]+)/);
    let transform = selectedPart.style.transform || (attrTransformMatch ? attrTransformMatch[1] : '') || '';

    // Remove existing rotate but keep everything else (translate, scale, scaleX, etc.)
    transform = transform.replace(/rotate\([^)]+\)/g, '').trim();

    // Build new transform with rotation first
    let newTransform = '';
    if (value != 0) newTransform = `rotate(${value}deg)`;
    if (transform) newTransform = newTransform ? `${newTransform} ${transform}` : transform;

    selectedPart.style.setProperty('transform', newTransform.trim() || 'none', 'important');
    document.getElementById('rotationValue').textContent = value + '¬∞';
    updateCSSOutput();
}

function updateScale(value) {
    if (!selectedPart) return;
    saveState();

    // Check if element has an animation that controls transform
    const computed = window.getComputedStyle(selectedPart);
    const animation = computed.animation || selectedPart.style.animation;

    if (animation && animation !== 'none' && animation !== '') {
        selectedPart.style.animationPlayState = 'paused';
        showToast('Animation paused for scaling');
    }

    // Get existing transform
    const attrStyle = selectedPart.getAttribute('style') || '';
    const attrTransformMatch = attrStyle.match(/transform\s*:\s*([^;]+)/);
    let transform = selectedPart.style.transform || (attrTransformMatch ? attrTransformMatch[1] : '') || '';

    // Remove existing scale but keep rotate and other transforms
    transform = transform.replace(/scale\([^)]+\)/g, '').trim();

    const scaleValue = value / 100;
    let newTransform = '';
    if (scaleValue !== 1) newTransform = `scale(${scaleValue})`;
    if (transform) newTransform = newTransform ? `${newTransform} ${transform}` : transform;

    selectedPart.style.setProperty('transform', newTransform.trim() || 'none', 'important');
    document.getElementById('scaleValue').textContent = value + '%';
    updateCSSOutput();
}

function updateWidth(value) {
    if (!selectedPart) return;
    saveState();

    const computed = window.getComputedStyle(selectedPart);
    const currentWidth = parseInt(computed.width) || 100;
    const ratio = value / currentWidth;

    // Update the selected element
    selectedPart.style.setProperty('width', value + 'px', 'important');

    // Also scale all child elements proportionally
    const children = selectedPart.querySelectorAll('*');
    children.forEach(child => {
        const childComputed = window.getComputedStyle(child);
        const childWidth = parseInt(childComputed.width);
        const childLeft = parseInt(childComputed.left);
        if (childWidth) {
            child.style.setProperty('width', Math.round(childWidth * ratio) + 'px', 'important');
        }
        if (childLeft && !isNaN(childLeft)) {
            child.style.setProperty('left', Math.round(childLeft * ratio) + 'px', 'important');
        }
    });

    document.getElementById('widthValue').textContent = value + 'px';
    updateCSSOutput();
}

function updateHeight(value) {
    if (!selectedPart) return;
    saveState();

    const computed = window.getComputedStyle(selectedPart);
    const currentHeight = parseInt(computed.height) || 100;
    const ratio = value / currentHeight;

    // Update the selected element
    selectedPart.style.setProperty('height', value + 'px', 'important');

    // Also scale all child elements proportionally
    const children = selectedPart.querySelectorAll('*');
    children.forEach(child => {
        const childComputed = window.getComputedStyle(child);
        const childHeight = parseInt(childComputed.height);
        const childTop = parseInt(childComputed.top);
        if (childHeight) {
            child.style.setProperty('height', Math.round(childHeight * ratio) + 'px', 'important');
        }
        if (childTop && !isNaN(childTop)) {
            child.style.setProperty('top', Math.round(childTop * ratio) + 'px', 'important');
        }
    });

    document.getElementById('heightValue').textContent = value + 'px';
    updateCSSOutput();
}

function applyTheme(themeName) {
    if (!selectedPart) {
        showToast('Select a part first!');
        return;
    }

    saveState();
    const colors = themes[themeName];
    const randomColor = colors[Math.floor(Math.random() * colors.length)];

    // Apply color with filter (simple approach that works on any element)
    selectedPart.style.filter = `hue-rotate(${Math.random() * 360}deg) saturate(1.2)`;

    selectedPart.classList.add('wiggle');
    setTimeout(() => selectedPart.classList.remove('wiggle'), 300);

    showToast('Theme applied! üé®');
    updateCSSOutput();
}

function applyCustomColor(color) {
    if (!selectedPart) {
        showToast('Select a part first!');
        return;
    }

    saveState();

    // Convert hex to HSL and apply hue rotation
    const r = parseInt(color.slice(1, 3), 16) / 255;
    const g = parseInt(color.slice(3, 5), 16) / 255;
    const b = parseInt(color.slice(5, 7), 16) / 255;

    const max = Math.max(r, g, b);
    const min = Math.min(r, g, b);
    let h = 0;

    if (max !== min) {
        const d = max - min;
        switch (max) {
            case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
            case g: h = ((b - r) / d + 2) / 6; break;
            case b: h = ((r - g) / d + 4) / 6; break;
        }
    }

    selectedPart.style.filter = `hue-rotate(${h * 360 - 330}deg)`;

    showToast('Color changed! üé®');
    updateCSSOutput();
}

function toggleGroupMode() {
    groupMode = !groupMode;
    const btn = document.getElementById('groupBtn');
    const indicator = document.getElementById('groupModeIndicator');

    if (groupMode) {
        btn.classList.add('active');
        indicator.classList.add('active');
        currentGroupSelection.clear();
        deselectAll();
        showToast('Click parts to add to group! üì¶');
    } else {
        btn.classList.remove('active');
        indicator.classList.remove('active');

        // If we have parts selected, create the group
        if (currentGroupSelection.size >= 2) {
            createGroup();
        } else if (currentGroupSelection.size === 1) {
            showToast('Need at least 2 parts to group! ‚ùå');
        }

        // Clear selection styling
        currentGroupSelection.forEach(partName => {
            const part = document.querySelector(`[data-part="${partName}"]`);
            if (part) part.classList.remove('group-selecting');
        });
        currentGroupSelection.clear();
    }
}

function togglePartInGroupSelection(part) {
    const partName = part.dataset.part;

    if (currentGroupSelection.has(partName)) {
        // Remove from selection
        currentGroupSelection.delete(partName);
        part.classList.remove('group-selecting');
        showToast(`Removed ${partName}! (${currentGroupSelection.size} selected)`);
    } else {
        // Add to selection
        currentGroupSelection.add(partName);
        part.classList.add('group-selecting');
        showToast(`Added ${partName}! (${currentGroupSelection.size} selected)`);
    }
}

function createGroup() {
    groupCounter++;
    const groupId = `group-${groupCounter}`;

    // Create the group
    groups.set(groupId, new Set(currentGroupSelection));

    // Map each part to this group
    currentGroupSelection.forEach(partName => {
        // Remove from old group if exists
        const oldGroupId = partToGroup.get(partName);
        if (oldGroupId) {
            const oldGroup = groups.get(oldGroupId);
            if (oldGroup) {
                oldGroup.delete(partName);
                if (oldGroup.size === 0) {
                    groups.delete(oldGroupId);
                }
            }
        }

        partToGroup.set(partName, groupId);

        const part = document.querySelector(`[data-part="${partName}"]`);
        if (part) {
            part.classList.remove('group-selecting');
            part.classList.add('grouped');
        }
    });

    showToast(`Group created with ${currentGroupSelection.size} parts! üì¶`);
}

function ungroupSelected() {
    if (!selectedPart) {
        showToast('Select a grouped part first! üëÜ');
        return;
    }

    const partName = selectedPart.dataset.part;
    const groupId = partToGroup.get(partName);

    if (!groupId) {
        showToast('This part is not in a group! ‚ùå');
        return;
    }

    const group = groups.get(groupId);
    if (!group) return;

    // Ungroup all parts in this group
    group.forEach(groupedName => {
        partToGroup.delete(groupedName);
        const part = document.querySelector(`[data-part="${groupedName}"]`);
        if (part) {
            part.classList.remove('grouped');
        }
    });

    groups.delete(groupId);
    showToast('Group removed! üì§');
}

function randomize() {
    saveState();

    document.querySelectorAll('[data-part]').forEach(part => {
        // Random position offset
        const currentTop = parseInt(part.style.top) || 0;
        const currentLeft = parseInt(part.style.left) || 0;

        part.style.top = (currentTop + (Math.random() - 0.5) * 40) + 'px';
        part.style.left = (currentLeft + (Math.random() - 0.5) * 40) + 'px';

        // Random rotation
        const rotation = (Math.random() - 0.5) * 30;
        let transform = part.style.transform || '';
        transform = transform.replace(/rotate\([^)]+\)/g, '').trim();
        part.style.transform = `rotate(${rotation}deg) ${transform}`.trim();

        // Random hue
        part.style.filter = `hue-rotate(${Math.random() * 360}deg)`;
    });

    if (selectedPart) {
        updateSliders();
        updateCSSOutput();
    }

    showToast('Mixed up! üé≤');
}

function updateCSSOutput() {
    if (!selectedPart) return;

    const style = selectedPart.style;
    const props = [];

    if (style.top) props.push(`top:${style.top}`);
    if (style.left) props.push(`left:${style.left}`);
    if (style.bottom) props.push(`bottom:${style.bottom}`);
    if (style.transform) props.push(`transform:${style.transform}`);
    if (style.filter) props.push(`filter:${style.filter}`);
    if (style.animation && style.animation !== 'none') props.push(`animation:${style.animation}`);
    if (style.zIndex) props.push(`z-index:${style.zIndex}`);

    const css = props.join('; ');
    document.getElementById('cssOutput').textContent = css || '/* No changes */';
}

function copyCSS() {
    const css = document.getElementById('cssOutput').textContent;
    navigator.clipboard.writeText(css).then(() => {
        const btn = document.getElementById('copyBtn');
        btn.textContent = '‚úÖ Copied!';
        btn.classList.add('copied');
        setTimeout(() => {
            btn.textContent = 'üìã Copy CSS';
            btn.classList.remove('copied');
        }, 1500);
    });
}

function toggleAnimations() {
    const stage = document.getElementById('stage');
    const btn = document.getElementById('pauseBtn');

    animationsPaused = !animationsPaused;

    if (animationsPaused) {
        stage.classList.add('animations-paused');
        btn.innerHTML = '<span class="icon">‚ñ∂Ô∏è</span> Play';
        btn.classList.add('active');
    } else {
        stage.classList.remove('animations-paused');
        btn.innerHTML = '<span class="icon">‚è∏Ô∏è</span> Pause';
        btn.classList.remove('active');
    }
}

function resetAll() {
    saveState();

    originalStyles.forEach((style, partName) => {
        const part = document.querySelector(`[data-part="${partName}"]`);
        if (part) {
            part.setAttribute('style', style);
            part.style.filter = '';
            part.style.animation = '';
            part.classList.remove('grouped');
        }
    });

    groups.clear();
    partToGroup.clear();

    if (selectedPart) {
        updateSliders();
        updateCSSOutput();
    }

    showToast('Reset! üîÑ');
}

function showToast(message) {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.classList.add('show');
    setTimeout(() => {
        toast.classList.remove('show');
    }, 2000);
}

// Animation ideas with fun names!
const animationIdeas = [
    { name: 'Bouncy!', css: 'bounce-custom 0.5s ease-in-out infinite', emoji: 'üèÄ' },
    { name: 'Wiggle!', css: 'wiggle-custom 0.3s ease-in-out infinite', emoji: 'üêõ' },
    { name: 'Spin!', css: 'spin-custom 2s linear infinite', emoji: 'üåÄ' },
    { name: 'Pulse!', css: 'pulse-custom 1s ease-in-out infinite', emoji: 'üíì' },
    { name: 'Shake!', css: 'shake-custom 0.5s ease-in-out infinite', emoji: 'ü´®' },
    { name: 'Float!', css: 'float-custom 2s ease-in-out infinite', emoji: '‚òÅÔ∏è' },
    { name: 'Jelly!', css: 'jelly-custom 0.8s ease-in-out infinite', emoji: 'üçÆ' },
    { name: 'Swing!', css: 'swing-custom 1s ease-in-out infinite', emoji: 'üéã' },
    { name: 'Zoom!', css: 'zoom-custom 0.6s ease-in-out infinite', emoji: 'üîç' },
    { name: 'Wobble!', css: 'wobble-custom 1s ease-in-out infinite', emoji: 'ü•¥' },
    { name: 'Flicker!', css: 'flicker-custom 0.2s steps(2) infinite', emoji: 'üí°' },
    { name: 'Tilt!', css: 'tilt-custom 0.5s ease-in-out infinite alternate', emoji: '‚ÜóÔ∏è' },
    { name: 'Pop!', css: 'pop-custom 0.4s ease-in-out infinite', emoji: 'üéà' },
    { name: 'Breathe!', css: 'breathe-custom 3s ease-in-out infinite', emoji: 'üå¨Ô∏è' },
    { name: 'Dance!', css: 'dance-custom 0.6s ease-in-out infinite', emoji: 'üíÉ' },
    { name: 'No Animation', css: 'none', emoji: '‚èπÔ∏è' }
];

// Add custom animation keyframes dynamically
const customAnimations = `
@keyframes bounce-custom { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
@keyframes wiggle-custom { 0%, 100% { transform: rotate(-3deg); } 50% { transform: rotate(3deg); } }
@keyframes spin-custom { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
@keyframes pulse-custom { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.15); } }
@keyframes shake-custom { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
@keyframes float-custom { 0%, 100% { transform: translateY(0) rotate(-2deg); } 50% { transform: translateY(-10px) rotate(2deg); } }
@keyframes jelly-custom { 0%, 100% { transform: scale(1, 1); } 25% { transform: scale(0.9, 1.1); } 50% { transform: scale(1.1, 0.9); } 75% { transform: scale(0.95, 1.05); } }
@keyframes swing-custom { 0%, 100% { transform: rotate(-10deg); } 50% { transform: rotate(10deg); } }
@keyframes zoom-custom { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.3); } }
@keyframes wobble-custom { 0%, 100% { transform: translateX(0) rotate(0); } 15% { transform: translateX(-10px) rotate(-5deg); } 30% { transform: translateX(8px) rotate(3deg); } 45% { transform: translateX(-6px) rotate(-3deg); } 60% { transform: translateX(4px) rotate(2deg); } 75% { transform: translateX(-2px) rotate(-1deg); } }
@keyframes flicker-custom { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
@keyframes tilt-custom { 0% { transform: rotate(-5deg); } 100% { transform: rotate(5deg); } }
@keyframes pop-custom { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
@keyframes breathe-custom { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.05); opacity: 0.9; } }
@keyframes dance-custom { 0%, 100% { transform: translateY(0) rotate(0); } 25% { transform: translateY(-5px) rotate(-5deg); } 50% { transform: translateY(0) rotate(0); } 75% { transform: translateY(-5px) rotate(5deg); } }
`;

// Add keyframes to page
const styleSheet = document.createElement('style');
styleSheet.textContent = customAnimations;
document.head.appendChild(styleSheet);

function generateAnimation() {
    if (!selectedPart) {
        // If no part selected, show a random animation idea as suggestion
        const idea = animationIdeas[Math.floor(Math.random() * (animationIdeas.length - 1))];
        showToast(`Try "${idea.name}" ${idea.emoji} - Select a part first!`);
        return;
    }

    saveState();

    // Pick a random animation
    const idea = animationIdeas[Math.floor(Math.random() * animationIdeas.length)];

    // Apply the animation
    selectedPart.style.animation = idea.css;

    // Wiggle feedback
    selectedPart.classList.add('wiggle');
    setTimeout(() => selectedPart.classList.remove('wiggle'), 300);

    showToast(`${idea.emoji} ${idea.name}`);
    updateCSSOutput();
}

// Apply a specific animation to selected part (and group if grouped)
function applyAnimation(animationCSS) {
    if (!selectedPart) {
        showToast('Select a part first! üëÜ');
        return;
    }

    saveState();

    // Get all parts to animate (selected + grouped)
    const partsToAnimate = [selectedPart];
    const partName = selectedPart.dataset.part;
    const groupId = partToGroup.get(partName);

    if (groupId) {
        const group = groups.get(groupId);
        if (group) {
            group.forEach(groupedName => {
                if (groupedName !== partName) {
                    const groupedPart = document.querySelector(`[data-part="${groupedName}"]`);
                    if (groupedPart) partsToAnimate.push(groupedPart);
                }
            });
        }
    }

    // Apply animation to all parts
    partsToAnimate.forEach(part => {
        part.style.animation = animationCSS;
    });

    // Show feedback
    if (animationCSS === 'none') {
        showToast(`‚èπÔ∏è Animation removed${groupId ? ' from group' : ''}!`);
    } else {
        const animName = animationCSS.split(' ')[0].replace('-custom', '');
        showToast(`‚ú® ${animName}${groupId ? ' (group)' : ''}!`);
    }

    updateCSSOutput();
}

// ============================================
// DUPLICATE FEATURE
// ============================================

function duplicatePart() {
    if (!selectedPart) {
        showToast('Select a part to copy first! üëÜ');
        return;
    }

    saveState();

    // Clone the element
    const clone = selectedPart.cloneNode(true);

    // Give it a new unique name
    shapeCounter++;
    const newName = `copy-${shapeCounter}`;
    clone.dataset.part = newName;

    // Offset position slightly
    const currentTop = parseInt(clone.style.top) || 0;
    const currentLeft = parseInt(clone.style.left) || 0;
    clone.style.top = (currentTop + 20) + 'px';
    clone.style.left = (currentLeft + 20) + 'px';

    // Remove selected class
    clone.classList.remove('selected', 'linked');

    // Add to creature container
    const creature = document.getElementById('creature');
    creature.querySelector('div').appendChild(clone);

    // Make it interactive
    makePartInteractive(clone);

    // Store original style
    originalStyles.set(newName, clone.getAttribute('style'));

    // Select the new copy
    selectPart(clone);

    showToast('Copied! üìã');
}

// ============================================
// DRAW FEATURE
// ============================================

function toggleDrawMode() {
    drawMode = !drawMode;
    const btn = document.getElementById('drawBtn');
    const picker = document.getElementById('shapePicker');
    const stage = document.getElementById('stage');

    if (drawMode) {
        btn.classList.add('active');
        picker.classList.add('active');
        stage.classList.add('draw-mode');
        deselectAll();
        showToast('Draw mode ON - click to place shapes! ‚úèÔ∏è');
    } else {
        btn.classList.remove('active');
        picker.classList.remove('active');
        stage.classList.remove('draw-mode');
    }
}

function selectShape(shape) {
    currentShape = shape;
    document.querySelectorAll('.shape-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.shape === shape);
    });
}

// Handle clicks on stage for drawing
document.getElementById('stage').addEventListener('click', (e) => {
    if (!drawMode) return;

    // Get click position relative to stage
    const stage = document.getElementById('stage');
    const rect = stage.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;

    // Don't draw if clicking on existing parts
    if (e.target.closest('[data-part]')) return;

    createShape(x, y);
});

function createShape(x, y) {
    saveState();

    const color = document.getElementById('drawColor').value;
    const size = parseInt(document.getElementById('drawSize').value);

    shapeCounter++;
    const shapeName = `${currentShape}-${shapeCounter}`;

    // Create the shape element
    const shape = document.createElement('div');
    shape.dataset.part = shapeName;
    shape.style.position = 'absolute';
    shape.style.left = (x - size/2) + 'px';
    shape.style.top = (y - size/2) + 'px';
    shape.style.width = size + 'px';
    shape.style.height = size + 'px';
    shape.style.zIndex = '50';

    // Apply shape-specific styles
    switch (currentShape) {
        case 'circle':
            shape.style.borderRadius = '50%';
            shape.style.background = `radial-gradient(circle at 35% 35%, ${lightenColor(color, 40)}, ${color})`;
            shape.style.border = `3px solid ${darkenColor(color, 30)}`;
            shape.style.boxShadow = `inset 3px 3px 8px rgba(255,255,255,0.5), inset -2px -2px 5px rgba(0,0,0,0.2)`;
            break;

        case 'square':
            shape.style.borderRadius = '8px';
            shape.style.background = `linear-gradient(135deg, ${lightenColor(color, 30)}, ${color})`;
            shape.style.border = `3px solid ${darkenColor(color, 30)}`;
            shape.style.boxShadow = `inset 3px 3px 8px rgba(255,255,255,0.5), inset -2px -2px 5px rgba(0,0,0,0.2)`;
            break;

        case 'heart':
            shape.style.background = 'transparent';
            shape.innerHTML = `<svg viewBox="0 0 100 100" width="${size}" height="${size}">
                <defs>
                    <linearGradient id="heartGrad${shapeCounter}" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:${lightenColor(color, 30)}"/>
                        <stop offset="100%" style="stop-color:${color}"/>
                    </linearGradient>
                </defs>
                <path d="M50 88 C20 60 5 40 15 25 C25 10 40 15 50 30 C60 15 75 10 85 25 C95 40 80 60 50 88Z"
                      fill="url(#heartGrad${shapeCounter})"
                      stroke="${darkenColor(color, 30)}"
                      stroke-width="3"/>
            </svg>`;
            break;

        case 'star':
            shape.style.background = 'transparent';
            shape.innerHTML = `<svg viewBox="0 0 100 100" width="${size}" height="${size}">
                <defs>
                    <linearGradient id="starGrad${shapeCounter}" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:${lightenColor(color, 40)}"/>
                        <stop offset="100%" style="stop-color:${color}"/>
                    </linearGradient>
                </defs>
                <polygon points="50,5 61,40 98,40 68,62 79,97 50,75 21,97 32,62 2,40 39,40"
                         fill="url(#starGrad${shapeCounter})"
                         stroke="${darkenColor(color, 30)}"
                         stroke-width="3"/>
            </svg>`;
            break;

        case 'triangle':
            shape.style.background = 'transparent';
            shape.innerHTML = `<svg viewBox="0 0 100 100" width="${size}" height="${size}">
                <defs>
                    <linearGradient id="triGrad${shapeCounter}" x1="0%" y1="100%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:${color}"/>
                        <stop offset="100%" style="stop-color:${lightenColor(color, 30)}"/>
                    </linearGradient>
                </defs>
                <polygon points="50,10 90,90 10,90"
                         fill="url(#triGrad${shapeCounter})"
                         stroke="${darkenColor(color, 30)}"
                         stroke-width="3"/>
            </svg>`;
            break;
    }

    // Add to stage
    const stage = document.getElementById('stage');
    stage.appendChild(shape);

    // Make it interactive
    makePartInteractive(shape);

    // Store original style
    originalStyles.set(shapeName, shape.getAttribute('style'));

    // Select it
    selectPart(shape);

    showToast(`${getShapeEmoji(currentShape)} Created!`);
}

function getShapeEmoji(shape) {
    const emojis = { circle: '‚≠ï', square: '‚¨ú', heart: '‚ù§Ô∏è', star: '‚≠ê', triangle: 'üî∫' };
    return emojis[shape] || '‚ú®';
}

// Color helpers
function lightenColor(hex, percent) {
    const num = parseInt(hex.slice(1), 16);
    const amt = Math.round(2.55 * percent);
    const R = Math.min(255, (num >> 16) + amt);
    const G = Math.min(255, ((num >> 8) & 0x00FF) + amt);
    const B = Math.min(255, (num & 0x0000FF) + amt);
    return `#${(1 << 24 | R << 16 | G << 8 | B).toString(16).slice(1)}`;
}

function darkenColor(hex, percent) {
    const num = parseInt(hex.slice(1), 16);
    const amt = Math.round(2.55 * percent);
    const R = Math.max(0, (num >> 16) - amt);
    const G = Math.max(0, ((num >> 8) & 0x00FF) - amt);
    const B = Math.max(0, (num & 0x0000FF) - amt);
    return `#${(1 << 24 | R << 16 | G << 8 | B).toString(16).slice(1)}`;
}

// Make a new element interactive (for duplicated/drawn shapes)
function makePartInteractive(part) {
    part.addEventListener('click', (e) => {
        e.stopPropagation();

        if (drawMode) return; // Don't select in draw mode

        if (groupMode) {
            togglePartInGroupSelection(part);
            return;
        }

        selectPart(part);
    });

    part.addEventListener('mousedown', startDrag);
    part.addEventListener('touchstart', startDrag, {passive: false});
}

// Delete selected part (for custom shapes)
document.addEventListener('keydown', (e) => {
    if ((e.key === 'Delete' || e.key === 'Backspace') && selectedPart) {
        const partName = selectedPart.dataset.part;
        if (canDeletePart(partName)) {
            saveState();
            selectedPart.remove();
            deselectAll();
            showToast('Deleted! üóëÔ∏è');
        } else {
            showToast("Can't delete original parts! ‚ùå");
        }
    }
});

// ============================================
// SAVE & SHARE FEATURES
// ============================================

function getCreatureHTML() {
    const creature = document.getElementById('creature');
    const name = document.getElementById('creatureName').value || 'My Creature';

    // Get the creature HTML and all custom animations
    const creatureHTML = creature.innerHTML;

    // Build a complete standalone HTML file
    return `<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>${name}</title>
<style>
body {
    margin: 0;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #a855f7 0%, #6366f1 50%, #3b82f6 100%);
    font-family: 'Comic Sans MS', system-ui, sans-serif;
}
.creature-container {
    background: radial-gradient(circle at 50% 30%, #fef9c3 0%, #fde68a 50%, #fcd34d 100%);
    border-radius: 25px;
    padding: 20px;
    border: 4px solid #f59e0b;
}
.creature-name {
    text-align: center;
    font-size: 24px;
    font-weight: 900;
    color: #db2777;
    margin-top: 15px;
    text-shadow: 2px 2px 0 #fce7f3;
}
/* Animations */
@keyframes blink{0%,90%,100%{transform:scaleY(1)}93%,97%{transform:scaleY(0.1)}}
@keyframes flamingo-sway{0%,100%{transform:rotate(-1deg) translateY(0)}50%{transform:rotate(1deg) translateY(-8px)}}
@keyframes flamingo-blink{0%,90%,100%{transform:scaleY(1)}93%,97%{transform:scaleY(0.1)}}
@keyframes neck-bob{0%,100%{transform:rotate(-2deg)}50%{transform:rotate(2deg)}}
@keyframes wing-flutter-l{0%,100%{transform:rotate(20deg)}50%{transform:rotate(30deg)}}
@keyframes wing-flutter-r{0%,100%{transform:rotate(-20deg)}50%{transform:rotate(-30deg)}}
@keyframes tail-wag{0%,100%{transform:rotate(-20deg)}50%{transform:rotate(-10deg)}}
@keyframes penguin-random-waddle{0%,30%{transform:rotate(0deg)}35%{transform:rotate(-2deg)}40%{transform:rotate(2deg)}45%{transform:rotate(-2deg)}50%{transform:rotate(2deg)}55%{transform:rotate(-2deg)}60%{transform:rotate(2deg)}65%{transform:rotate(0deg)}100%{transform:rotate(0deg)}}
@keyframes penguin-blink{0%,90%,100%{transform:scaleY(1)}93%,97%{transform:scaleY(0.1)}}
@keyframes penguin-eye-look{0%,20%{top:3px;left:3px}25%,35%{top:3px;left:8px}40%,50%{top:6px;left:5px}55%,70%{top:3px;left:1px}75%,90%{top:5px;left:6px}95%,100%{top:3px;left:3px}}
@keyframes penguin-foot-l{0%,30%{transform:rotate(0deg) translateY(0)}35%{transform:rotate(8deg) translateY(-6px)}40%{transform:rotate(0deg) translateY(0)}45%{transform:rotate(8deg) translateY(-6px)}50%{transform:rotate(0deg) translateY(0)}55%{transform:rotate(8deg) translateY(-6px)}60%{transform:rotate(0deg) translateY(0)}65%,100%{transform:rotate(0deg) translateY(0)}}
@keyframes penguin-foot-r{0%,32%{transform:rotate(0deg) translateY(0)}37%{transform:rotate(-8deg) translateY(-6px)}42%{transform:rotate(0deg) translateY(0)}47%{transform:rotate(-8deg) translateY(-6px)}52%{transform:rotate(0deg) translateY(0)}57%{transform:rotate(-8deg) translateY(-6px)}62%{transform:rotate(0deg) translateY(0)}67%,100%{transform:rotate(0deg) translateY(0)}}
@keyframes penguin-flipper-l{0%,30%{transform:rotate(15deg)}35%{transform:rotate(45deg)}38%{transform:rotate(15deg)}42%{transform:rotate(45deg)}45%{transform:rotate(15deg)}50%{transform:rotate(45deg)}53%{transform:rotate(15deg)}58%{transform:rotate(45deg)}62%{transform:rotate(15deg)}65%,100%{transform:rotate(15deg)}}
@keyframes penguin-flipper-r{0%,30%{transform:rotate(-15deg)}35%{transform:rotate(-45deg)}38%{transform:rotate(-15deg)}42%{transform:rotate(-45deg)}45%{transform:rotate(-15deg)}50%{transform:rotate(-45deg)}53%{transform:rotate(-15deg)}58%{transform:rotate(-45deg)}62%{transform:rotate(-15deg)}65%,100%{transform:rotate(-15deg)}}
@keyframes penguin-tail-wag{0%,30%{transform:translateX(-50%) rotate(0deg)}35%,40%,45%,50%,55%,60%{transform:translateX(-50%) rotate(5deg)}37%,42%,47%,52%,57%{transform:translateX(-50%) rotate(-5deg)}65%,100%{transform:translateX(-50%) rotate(0deg)}}
/* Pterodactyl Animations */
@keyframes ptero-glide{0%,100%{transform:translateY(0) rotate(0deg)}50%{transform:translateY(-10px) rotate(0deg)}}
@keyframes ptero-wing-l{0%,100%{transform:rotate(10deg)}50%{transform:rotate(-30deg)}}
@keyframes ptero-wing-r{0%,100%{transform:rotate(-10deg)}50%{transform:rotate(30deg)}}
@keyframes ptero-blink{0%,85%,100%{transform:scaleY(1)}88%,92%{transform:scaleY(0.1)}95%{transform:scaleY(1)}97%{transform:scaleY(0.1)}}
/* Pterodactyl Wing Folding - V folds to I shape, wings fold DOWN toward body */
/* Left wing: base -90deg horizontal, folds down. Right wing: base +90deg horizontal, folds down */
@keyframes ptero-upper-arm-l{0%,40%{transform:rotate(-90deg)}45%,95%{transform:rotate(-45deg)}100%{transform:rotate(-90deg)}}
@keyframes ptero-forearm-l{0%,40%{transform:rotate(0deg)}45%,95%{transform:rotate(-90deg)}100%{transform:rotate(0deg)}}
@keyframes ptero-finger-l{0%,40%{transform:rotate(0deg)}45%,95%{transform:rotate(-120deg)}100%{transform:rotate(0deg)}}
@keyframes ptero-upper-arm-r{0%,40%{transform:rotate(90deg)}45%,95%{transform:rotate(45deg)}100%{transform:rotate(90deg)}}
@keyframes ptero-forearm-r{0%,40%{transform:rotate(0deg)}45%,95%{transform:rotate(90deg)}100%{transform:rotate(0deg)}}
@keyframes ptero-finger-r{0%,40%{transform:rotate(0deg)}45%,95%{transform:rotate(120deg)}100%{transform:rotate(0deg)}}
@keyframes tuft-sway{0%,100%{transform:rotate(var(--base-rotate, 0deg))}50%{transform:rotate(calc(var(--base-rotate, 0deg) + 10deg))}}
@keyframes flamingo-upper-leg-tuck{0%,40%{transform:rotate(5deg)}45%,95%{transform:rotate(60deg)}100%{transform:rotate(5deg)}}
@keyframes flamingo-lower-leg-fold{0%,40%{transform:rotate(0deg)}45%,95%{transform:rotate(-140deg)}100%{transform:rotate(0deg)}}
@keyframes flamingo-foot-tuck{0%,40%{transform:rotate(0deg) scale(1)}45%,95%{transform:rotate(50deg) scale(0.7)}100%{transform:rotate(0deg) scale(1)}}
/* Custom animations */
@keyframes bounce-custom{0%,100%{transform:translateY(0)}50%{transform:translateY(-15px)}}
@keyframes wiggle-custom{0%,100%{transform:rotate(-3deg)}50%{transform:rotate(3deg)}}
@keyframes spin-custom{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
@keyframes pulse-custom{0%,100%{transform:scale(1)}50%{transform:scale(1.15)}}
@keyframes shake-custom{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
@keyframes float-custom{0%,100%{transform:translateY(0) rotate(-2deg)}50%{transform:translateY(-10px) rotate(2deg)}}
@keyframes jelly-custom{0%,100%{transform:scale(1,1)}25%{transform:scale(0.9,1.1)}50%{transform:scale(1.1,0.9)}75%{transform:scale(0.95,1.05)}}
@keyframes swing-custom{0%,100%{transform:rotate(-10deg)}50%{transform:rotate(10deg)}}
@keyframes zoom-custom{0%,100%{transform:scale(1)}50%{transform:scale(1.3)}}
@keyframes wobble-custom{0%,100%{transform:translateX(0) rotate(0)}15%{transform:translateX(-10px) rotate(-5deg)}30%{transform:translateX(8px) rotate(3deg)}45%{transform:translateX(-6px) rotate(-3deg)}60%{transform:translateX(4px) rotate(2deg)}75%{transform:translateX(-2px) rotate(-1deg)}}
@keyframes flicker-custom{0%,100%{opacity:1}50%{opacity:0.5}}
@keyframes tilt-custom{0%{transform:rotate(-5deg)}100%{transform:rotate(5deg)}}
@keyframes pop-custom{0%,100%{transform:scale(1)}50%{transform:scale(1.2)}}
@keyframes breathe-custom{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.05);opacity:0.9}}
@keyframes dance-custom{0%,100%{transform:translateY(0) rotate(0)}25%{transform:translateY(-5px) rotate(-5deg)}50%{transform:translateY(0) rotate(0)}75%{transform:translateY(-5px) rotate(5deg)}}
</style>
</head>
<body>
<div class="creature-container">
${creatureHTML}
</div>
<div class="creature-name">${name}</div>
</body>
</html>`;
}

function downloadCreature() {
    const name = document.getElementById('creatureName').value || 'My Creature';
    const html = getCreatureHTML();

    // Create download link
    const blob = new Blob([html], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${name.replace(/[^a-z0-9]/gi, '_')}.html`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);

    showToast('Downloaded! üì•');
}

function copyCreatureCode() {
    const html = getCreatureHTML();

    navigator.clipboard.writeText(html).then(() => {
        showToast('Code copied! üìã Share it with friends!');
    }).catch(() => {
        showToast('Could not copy üò¢');
    });
}

function takeScreenshot() {
    const stage = document.getElementById('stage');

    // Remove selection styling temporarily
    const selectedEl = document.querySelector('[data-part].selected');
    if (selectedEl) selectedEl.classList.remove('selected');

    // Use html2canvas if available, otherwise provide instructions
    if (typeof html2canvas !== 'undefined') {
        html2canvas(stage, {
            backgroundColor: null,
            scale: 2
        }).then(canvas => {
            const link = document.createElement('a');
            const name = document.getElementById('creatureName').value || 'My Creature';
            link.download = `${name.replace(/[^a-z0-9]/gi, '_')}.png`;
            link.href = canvas.toDataURL();
            link.click();
            showToast('Screenshot saved! üì∏');
        });
    } else {
        // Fallback: Open print dialog or give instructions
        showToast('Tip: Press Cmd+Shift+4 (Mac) or Win+Shift+S (PC) to screenshot! üì∏');
    }

    // Restore selection
    if (selectedEl) selectedEl.classList.add('selected');
}
</script>

</body>
</html>
